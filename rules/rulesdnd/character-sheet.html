<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
  <link rel="stylesheet" href="../style.css" />
  <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
  <style>
    /* === –û—Å–Ω–æ–≤–Ω–æ–π –º–∞–∫–µ—Ç: 2 –∫–æ–ª–æ–Ω–∫–∏ —Å–≤–µ—Ä—Ö—É, 1 –∫–æ–ª–æ–Ω–∫–∞ —Å–Ω–∏–∑—É === */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 20px 0;
    }

    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }

    .form-section {
      background-color: #4a2f1a;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #8b6f47;
      margin-bottom: 20px;
    }

    .form-section h3 {
      color: #d4af37;
      margin-top: 0;
      border-bottom: 1px solid #8b6f47;
      padding-bottom: 5px;
      margin-bottom: 15px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-row > label {
      flex: 1;
      min-width: 150px;
    }

    .form-row input,
    .form-row select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #8b6f47;
      background: #5a3b26;
      color: #e0ccb6;
      font-size: 1em;
      box-sizing: border-box;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .stat-box {
      text-align: center;
      background: #5a3b26;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #8b6f47;
    }

    .stat-box label {
      font-size: 0.9em;
      display: block;
      margin-bottom: 5px;
    }

    .stat-box input {
      width: 100%;
      text-align: center;
      font-weight: bold;
      font-size: 1.1em;
      padding: 5px;
      max-width: 70px;
      margin: 0 auto;
    }

    .stat-mod {
      font-size: 0.9em;
      color: #b8a594;
    }

    .skills-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      list-style: none;
      padding: 0;
      margin-top: 10px;
    }

    .skills-grid li {
      font-size: 0.95em;
    }

    .skills-grid label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .skills-grid input[type="checkbox"] {
      margin-right: 8px;
      transform: scale(1.2);
    }

    /* === –°–≤–æ–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–∏—Ç–æ–≥–æ–≤—ã–π –±–ª–æ–∫) === */
    .char-summary {
      background: linear-gradient(145deg, #5a3b26, #4a2e1a);
      border: 2px solid #8b6f47;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 
        0 6px 0 #3a2410,
        0 6px 15px rgba(0, 0, 0, 0.5);
      text-align: center;
      margin-top: 30px;
      position: relative;
    }

    .avatar-container {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 2px solid #d4af37;
      overflow: hidden;
      margin: 0 auto 15px;
      background-color: #3a2410;
    }

    .avatar-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .summary-name {
      font-size: 1.8em;
      color: #f0d98f;
      margin: 10px 0;
    }

    .summary-details {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      font-size: 0.95em;
      margin-bottom: 20px;
    }

    .summary-details > div {
      border-right: 1px solid #8b6f47;
      padding: 0 10px;
    }

    .summary-details > div:last-child {
      border-right: none;
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin: 20px 0;
    }

    .summary-stat {
      background: rgba(0, 0, 0, 0.2);
      padding: 10px 5px;
      border-radius: 6px;
      border: 1px solid #5a3b26;
    }

    .summary-stat-name {
      font-size: 0.8em;
      color: #b8a594;
    }

    .summary-stat-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #f0d98f;
    }

    .summary-stat-mod {
      font-size: 0.9em;
      color: #d4af37;
    }

    .summary-combat {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      font-size: 0.95em;
    }

    .summary-quick-info {
      text-align: left;
      margin-top: 20px;
      font-size: 0.9em;
    }

    .summary-quick-info h4 {
      color: #d4af37;
      border-bottom: 1px solid #8b6f47;
      padding-bottom: 3px;
      margin: 10px 0 5px;
    }

    /* === –ò–ó–ú–ï–ù–ï–ù–ò–Ø === */
    /* –°–ø–∞—Å–±—Ä–æ—Å–∫–∏: 1 —Å—Ç–æ–ª–±–µ—Ü */
    .summary-saves {
      columns: 1;
      column-gap: 20px;
      list-style-type: none;
      padding-left: 10px;
      margin: 0;
    }

    .summary-saves li {
      margin-bottom: 5px;
      padding: 3px 0;
      border-bottom: 1px dotted #5a3b26;
    }

    /* –ù–∞–≤—ã–∫–∏: 4 —Å—Ç–æ–ª–±—Ü–∞ (5, 5, 5, 3) */
    .summary-skills {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      list-style-type: none;
      padding-left: 10px;
      margin: 0;
    }

    .summary-skills li {
      margin-bottom: 5px;
      padding: 3px 0;
      border-bottom: 1px dotted #5a3b26;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ */
    .form-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
      justify-content: center;
    }

    .btn-primary, .btn-secondary, .btn-clear, .btn-print-summary {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: #d4af37;
      color: #1a110a;
    }

    .btn-secondary {
      background: #5a3b26;
      color: #d4af37;
      border: 1px solid #8b6f47;
    }

    .btn-clear {
      background: #8b4513;
      color: #fff;
    }

    .btn-print-summary {
      background: #5a3b26;
      color: #d4af37;
      border: 1px solid #8b6f47;
    }

    .btn-primary:hover,
    .btn-secondary:hover,
    .btn-clear:hover,
    .btn-print-summary:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
    }

    .btn-primary:active,
    .btn-secondary:active,
    .btn-clear:active,
    .btn-print-summary:active {
      transform: scale(0.98);
    }

    /* === –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π === */
    .char-manager {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .char-manager select {
      flex-grow: 1;
      max-width: 300px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #8b6f47;
      background: #5a3b26;
      color: #e0ccb6;
      font-size: 1em;
      box-sizing: border-box;
    }

    .char-manager button {
      padding: 8px 12px;
      border-radius: 4px;
      border: none;
      background: #5a3b26;
      color: #d4af37;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    .char-manager button:hover {
      background: #6b4426;
      transform: scale(1.05);
    }

    @media (max-width: 768px) {
      .summary-stats {
        grid-template-columns: repeat(3, 1fr);
      }

      .summary-details {
        flex-direction: column;
        align-items: center;
      }

      .summary-details > div {
        border-right: none;
        padding: 5px 0;
      }

      .summary-quick-info ul {
        columns: 1;
      }

      .summary-skills {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h1>
      <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º D&D 5e</p>
    </header>

    <nav>
      <a href="dnd.html" class="btn-back">
        <span class="arrow">‚Üê</span>
        <span class="text">–í –º–µ–Ω—é D&D</span>
      </a>
    </nav>

    <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π -->
    <div class="char-manager">
        <select id="char-selector">
            <option value="">-- –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ --</option>
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </select>
        <button id="new-char-btn">–ù–æ–≤—ã–π</button>
        <button id="delete-char-btn">–£–¥–∞–ª–∏—Ç—å</button>
        <button id="export-txt-btn">–≠–∫—Å–ø–æ—Ä—Ç (.txt)</button>
        <!-- <button id="export-pdf-btn">–≠–∫—Å–ø–æ—Ä—Ç (.pdf)</button> --> <!-- –ó–∞–≥–ª—É—à–∫–∞ -->
    </div>

    <main class="main-layout">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
      <div class="left-column">
        <div class="form-section">
          <h3>üìù –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
          <div class="form-row">
            <label>
              –ò–º—è:
              <input type="text" id="char-name" placeholder="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" />
            </label>
            <label>
              –ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è:
              <input type="text" id="char-background" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ—Å—Ç–æ–ª—é–¥–∏–Ω" />
            </label>
          </div>
          <div class="form-row">
            <label>
              –ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:
              <select id="char-alignment">
                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π">–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π</option>
                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π</option>
                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π">–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π</option>
              </select>
            </label>
            <label>
              –û–ø—ã—Ç:
              <input type="number" id="char-exp" value="0" min="0" />
            </label>
          </div>
          <div class="form-row">
            <label>
              –ê–≤–∞—Ç–∞—Ä:
              <input type="file" id="avatar-upload" accept="image/*">
            </label>
          </div>
        </div>

        <div class="form-section">
          <h3>üß¨ –†–∞—Å–∞ –∏ –ö–ª–∞—Å—Å</h3>
          <div class="form-row">
            <label>
              –†–∞—Å–∞:
              <select id="char-race">
                <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
                <option value="elf">–≠–ª—å—Ñ</option>
                <option value="dwarf">–î–≤–∞—Ä—Ñ</option>
                <option value="halfling">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫</option>
                <option value="gnome">–ì–Ω–æ–º</option>
                <option value="half-elf">–ü–æ–ª—É—ç–ª—å—Ñ</option>
                <option value="half-orc">–ü–æ–ª—É–æ—Ä–∫</option>
                <option value="tiefling">–¢–∏—Ñ–ª–∏–Ω–≥</option>
                <option value="aarakocra">–ê–∞—Ä–∞–∫–æ–∫—Ä–∞</option>
                <option value="aasimar">–ê–∞—Å–∏–º–∞—Ä</option>
                <option value="bugbear">–ë–∞–≥–±–∏—Ä</option>
                <option value="gith">–ì–∏—Ç</option>
                <option value="giff">–ì–∏—Ñ—Ñ</option>
                <option value="simic-hybrid">–ì–∏–±—Ä–∏–¥ –°–∏–º–∏–∫–æ–≤</option>
                <option value="verdan">–í–µ—Ä–¥–∞–Ω</option>
                <option value="vedalken">–í–µ–¥–∞–ª–∫–µ–Ω</option>
                <option value="autognome">–ê–≤—Ç–æ–≥–Ω–æ–º</option>
                <!-- –î–æ–±–∞–≤—å –±–æ–ª—å—à–µ —Ä–∞—Å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ -->
              </select>
            </label>
            <label>
              –ö–ª–∞—Å—Å:
              <select id="char-class">
                <option value="–≤–æ–∏–Ω">–í–æ–∏–Ω</option>
                <option value="–º–∞–≥">–ú–∞–≥</option>
                <option value="–∂—Ä–µ—Ü">–ñ—Ä–µ—Ü</option>
                <option value="—Ä–∞–∑–±–æ–π–Ω–∏–∫">–†–∞–∑–±–æ–π–Ω–∏–∫</option>
                <option value="–ø–∞–ª–∞–¥–∏–Ω">–ü–∞–ª–∞–¥–∏–Ω</option>
                <option value="—Å–ª–µ–¥–æ–ø—ã—Ç">–°–ª–µ–¥–æ–ø—ã—Ç</option>
                <option value="–≤–∞—Ä–≤–∞—Ä">–í–∞—Ä–≤–∞—Ä</option>
                <option value="–¥—Ä—É–∏–¥">–î—Ä—É–∏–¥</option>
                <option value="–±–∞—Ä–¥">–ë–∞—Ä–¥</option>
                <option value="—á–∞—Ä–æ–¥–µ–π">–ß–∞—Ä–æ–¥–µ–π</option>
                <option value="–∫–æ–ª–¥—É–Ω">–ö–æ–ª–¥—É–Ω</option>
                <option value="–º–æ–Ω–∞—Ö">–ú–æ–Ω–∞—Ö</option>
              </select>
            </label>
            <label>
              –£—Ä–æ–≤–µ–Ω—å:
              <input type="number" id="char-level" min="1" max="20" value="1" />
            </label>
          </div>
        </div>

        <div class="form-section">
          <h3>üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
          <div class="stats-grid">
            <div class="stat-box">
              <label for="str">–°–ò–õ</label>
              <input type="number" id="str" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="str-mod">+0</span>)</div>
            </div>
            <div class="stat-box">
              <label for="dex">–õ–û–í</label>
              <input type="number" id="dex" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="dex-mod">+0</span>)</div>
            </div>
            <div class="stat-box">
              <label for="con">–¢–ï–õ</label>
              <input type="number" id="con" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="con-mod">+0</span>)</div>
            </div>
            <div class="stat-box">
              <label for="int">–ò–ù–¢</label>
              <input type="number" id="int" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="int-mod">+0</span>)</div>
            </div>
            <div class="stat-box">
              <label for="wis">–ú–î–†</label>
              <input type="number" id="wis" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="wis-mod">+0</span>)</div>
            </div>
            <div class="stat-box">
              <label for="cha">–•–ê–†</label>
              <input type="number" id="cha" min="3" max="20" value="10" />
              <div class="stat-mod">(<span id="cha-mod">+0</span>)</div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ë–æ–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ –Ω–∞–≤—ã–∫–∏ -->
      <div class="right-column">
        <div class="form-section">
          <h3>üõ°Ô∏è –ë–æ–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
          <div class="form-row">
            <label>
              –ö–æ—Å—Ç—å –•–∏—Ç–æ–≤ (HD):
              <input type="text" id="hit-die" placeholder="1–∫10" readonly />
            </label>
            <label>
              –¢–µ–∫—É—â–∏–µ –•–ü:
              <input type="number" id="current-hp" placeholder="–¢–µ–∫—É—â–∏–µ" />
            </label>
            <label>
              –ú–∞–∫—Å. –•–ü:
              <input type="number" id="max-hp" placeholder="–ú–∞–∫—Å–∏–º—É–º" />
            </label>
          </div>
          <div class="form-row">
            <label>
              –ö–î (–±–µ–∑ –¥–æ—Å–ø–∞—Ö–∞):
              <span id="calculated-ac">10</span>
            </label>
            <label>
              –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ñ—É—Ç—ã):
              <input type="number" id="base-speed" value="30" min="0" />
            </label>
            <label>
              –°–∫–æ—Ä–æ—Å—Ç—å (—Ñ—É—Ç—ã):
              <span id="calculated-speed">30</span>
            </label>
          </div>
          <div class="form-row">
            <label>
              –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:
              <span id="calculated-init">+0</span>
            </label>
          </div>
        </div>

        <div class="form-section">
          <h3>üéØ –ù–∞–≤—ã–∫–∏</h3>
          <ul class="skills-grid">
            <li><label><input type="checkbox" id="skill-acrobatics"> –ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞ (DEX)</label></li>
            <li><label><input type="checkbox" id="skill-animal-handling"> –£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏ (WIS)</label></li>
            <li><label><input type="checkbox" id="skill-arcana"> –ú–∞–≥–∏—è (INT)</label></li>
            <li><label><input type="checkbox" id="skill-athletics"> –ê—Ç–ª–µ—Ç–∏–∫–∞ (STR)</label></li>
            <li><label><input type="checkbox" id="skill-deception"> –û–±–º–∞–Ω (CHA)</label></li>
            <li><label><input type="checkbox" id="skill-history"> –ò—Å—Ç–æ—Ä–∏—è (INT)</label></li>
            <li><label><input type="checkbox" id="skill-insight"> –ü—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (WIS)</label></li>
            <li><label><input type="checkbox" id="skill-intimidation"> –ó–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ (CHA)</label></li>
            <li><label><input type="checkbox" id="skill-investigation"> –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (INT)</label></li>
            <li><label><input type="checkbox" id="skill-medicine"> –ú–µ–¥–∏—Ü–∏–Ω–∞ (WIS)</label></li>
            <li><label><input type="checkbox" id="skill-nature"> –ü—Ä–∏—Ä–æ–¥–∞ (INT)</label></li>
            <li><label><input type="checkbox" id="skill-perception"> –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ (WIS)</label></li>
            <li><label><input type="checkbox" id="skill-performance"> –í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ (CHA)</label></li>
            <li><label><input type="checkbox" id="skill-persuasion"> –£–±–µ–∂–¥–µ–Ω–∏–µ (CHA)</label></li>
            <li><label><input type="checkbox" id="skill-religion"> –†–µ–ª–∏–≥–∏—è (INT)</label></li>
            <li><label><input type="checkbox" id="skill-sleight-of-hand"> –õ–æ–≤–∫–æ—Å—Ç—å —Ä—É–∫ (DEX)</label></li>
            <li><label><input type="checkbox" id="skill-stealth"> –°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å (DEX)</label></li>
            <li><label><input type="checkbox" id="skill-survival"> –í—ã–∂–∏–≤–∞–Ω–∏–µ (WIS)</label></li>
          </ul>
        </div>

        <div class="form-buttons">
          <button id="save-char" class="btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="export-char" class="btn-secondary">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
          <button id="reset-char" class="btn-clear">üóëÔ∏è –°–±—Ä–æ—Å</button>
          <a href="print-character.html" target="_blank" class="btn-print-summary">üñ®Ô∏è –ü–µ—á–∞—Ç—å</a>
        </div>
      </div>

      <!-- –ù–∏–∂–Ω–∏–π –±–ª–æ–∫: –°–≤–æ–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
      <div class="summary-section" style="grid-column: 1 / -1;">
        <h2>üé≠ –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</h2>
        <div class="char-summary">
          <div class="avatar-container">
            <img id="summary-avatar" src="https://via.placeholder.com/100x100/3a2a1a/d4af37?text=üë§" alt="–ê–≤–∞—Ç–∞—Ä">
          </div>
          <div class="summary-name" id="summary-name">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
          <div class="summary-details">
            <div><strong>–†–∞—Å–∞:</strong> <span id="summary-race">—á–µ–ª–æ–≤–µ–∫</span></div>
            <div><strong>–ö–ª–∞—Å—Å:</strong> <span id="summary-class">–≤–æ–∏–Ω</span></div>
            <div><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="summary-level">1</span></div>
            <div><strong>–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è:</strong> <span id="summary-bg">-</span></div>
            <div><strong>–ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:</strong> <span id="summary-align">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</span></div>
          </div>

          <div class="summary-combat">
            <div><strong>–ö–î:</strong> <span id="summary-ac">10</span></div>
            <div><strong>–•–ü:</strong> <span id="summary-hp">0</span>/<span id="summary-max-hp">0</span></div>
            <div><strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> <span id="summary-speed">30</span> —Ñ—É—Ç–æ–≤</div>
            <div><strong>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:</strong> <span id="summary-init">+0</span></div>
          </div>

          <div class="summary-stats">
            <div class="summary-stat">
              <div class="summary-stat-name">–°–ò–õ</div>
              <div class="summary-stat-value" id="summary-str-val">10</div>
              <div class="summary-stat-mod" id="summary-str-mod">+0</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-name">–õ–û–í</div>
              <div class="summary-stat-value" id="summary-dex-val">10</div>
              <div class="summary-stat-mod" id="summary-dex-mod">+0</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-name">–¢–ï–õ</div>
              <div class="summary-stat-value" id="summary-con-val">10</div>
              <div class="summary-stat-mod" id="summary-con-mod">+0</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-name">–ò–ù–¢</div>
              <div class="summary-stat-value" id="summary-int-val">10</div>
              <div class="summary-stat-mod" id="summary-int-mod">+0</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-name">–ú–î–†</div>
              <div class="summary-stat-value" id="summary-wis-val">10</div>
              <div class="summary-stat-mod" id="summary-wis-mod">+0</div>
            </div>
            <div class="summary-stat">
              <div class="summary-stat-name">–•–ê–†</div>
              <div class="summary-stat-value" id="summary-cha-val">10</div>
              <div class="summary-stat-mod" id="summary-cha-mod">+0</div>
            </div>
          </div>

          <div class="summary-quick-info">
            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
              <div>
                <h4>–°–ø–∞—Å–±—Ä–æ—Å–∫–∏</h4>
                <ul id="summary-saves" class="summary-saves">
                  <li>–°–∏–ª: +0</li>
                  <li>–õ–æ–≤: +0</li>
                  <li>–¢–µ–ª: +0</li>
                  <li>–ò–Ω—Ç: +0</li>
                  <li>–ú–¥—Ä: +0</li>
                  <li>–•–∞—Ä: +0</li>
                </ul>
              </div>
              <div>
                <h4>–ù–∞–≤—ã–∫–∏</h4>
                <ul id="summary-skills" class="summary-skills">
                  <li>–ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞: +0</li>
                  <li>–£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏: +0</li>
                  <li>–ú–∞–≥–∏—è: +0</li>
                  <li>–ê—Ç–ª–µ—Ç–∏–∫–∞: +0</li>
                  <li>–û–±–º–∞–Ω: +0</li>
                  <li>–ò—Å—Ç–æ—Ä–∏—è: +0</li>
                  <li>–ü—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: +0</li>
                  <li>–ó–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ: +0</li>
                  <li>–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: +0</li>
                  <li>–ú–µ–¥–∏—Ü–∏–Ω–∞: +0</li>
                  <li>–ü—Ä–∏—Ä–æ–¥–∞: +0</li>
                  <li>–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ: +0</li>
                  <li>–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ: +0</li>
                  <li>–£–±–µ–∂–¥–µ–Ω–∏–µ: +0</li>
                  <li>–†–µ–ª–∏–≥–∏—è: +0</li>
                  <li>–õ–æ–≤–∫–æ—Å—Ç—å —Ä—É–∫: +0</li>
                  <li>–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å: +0</li>
                  <li>–í—ã–∂–∏–≤–∞–Ω–∏–µ: +0</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>–õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è D&D 5e</p>
    </footer>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // --- –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã ---
      const charSelector = document.getElementById('char-selector');
      const newCharBtn = document.getElementById('new-char-btn');
      const deleteCharBtn = document.getElementById('delete-char-btn');
      const exportTxtBtn = document.getElementById('export-txt-btn');
      // const exportPdfBtn = document.getElementById('export-pdf-btn'); // –ó–∞–≥–ª—É—à–∫–∞

      const nameInput = document.getElementById('char-name');
      const bgInput = document.getElementById('char-background');
      const alignSelect = document.getElementById('char-alignment');
      const expInput = document.getElementById('char-exp');
      const avatarUpload = document.getElementById('avatar-upload');

      const raceSelect = document.getElementById('char-race');
      const classSelect = document.getElementById('char-class');
      const levelInput = document.getElementById('char-level');

      const strInput = document.getElementById('str');
      const dexInput = document.getElementById('dex');
      const conInput = document.getElementById('con');
      const intInput = document.getElementById('int');
      const wisInput = document.getElementById('wis');
      const chaInput = document.getElementById('cha');

      const hitDieInput = document.getElementById('hit-die');
      const currentHpInput = document.getElementById('current-hp');
      const maxHpInput = document.getElementById('max-hp');
      const baseSpeedInput = document.getElementById('base-speed');

      const saveBtn = document.getElementById('save-char');
      const exportBtn = document.getElementById('export-char');
      const resetBtn = document.getElementById('reset-char');

      // --- –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ---
      const summaryAvatar = document.getElementById('summary-avatar');
      const preview = {
        name: document.getElementById('summary-name'),
        race: document.getElementById('summary-race'),
        class: document.getElementById('summary-class'),
        level: document.getElementById('summary-level'),
        bg: document.getElementById('summary-bg'),
        align: document.getElementById('summary-align'),
        ac: document.getElementById('summary-ac'),
        hp: document.getElementById('summary-hp'),
        maxHp: document.getElementById('summary-max-hp'),
        speed: document.getElementById('summary-speed'),
        init: document.getElementById('summary-init'),
        strVal: document.getElementById('summary-str-val'),
        dexVal: document.getElementById('summary-dex-val'),
        conVal: document.getElementById('summary-con-val'),
        intVal: document.getElementById('summary-int-val'),
        wisVal: document.getElementById('summary-wis-val'),
        chaVal: document.getElementById('summary-cha-val'),
        strMod: document.getElementById('summary-str-mod'),
        dexMod: document.getElementById('summary-dex-mod'),
        conMod: document.getElementById('summary-con-mod'),
        intMod: document.getElementById('summary-int-mod'),
        wisMod: document.getElementById('summary-wis-mod'),
        chaMod: document.getElementById('summary-cha-mod'),
        savesList: document.getElementById('summary-saves'),
        skillsList: document.getElementById('summary-skills')
      };

      // --- –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è ---
      const calculatedAc = document.getElementById('calculated-ac');
      const calculatedSpeed = document.getElementById('calculated-speed');
      const calculatedInit = document.getElementById('calculated-init');

      // --- Skill Checkboxes ---
      const skillCheckboxes = {};
      document.querySelectorAll('.skills-grid input[type="checkbox"]').forEach(cb => {
        skillCheckboxes[cb.id.replace('skill-', '')] = cb;
      });

      // --- Data ---
      const raceData = {
        'human': { bonuses: { str: 1, dex: 1, con: 1, int: 1, wis: 1, cha: 1 }, speed: 30 },
        'elf': { bonuses: { dex: 2 }, speed: 30 },
        'dwarf': { bonuses: { con: 2 }, speed: 25 },
        'halfling': { bonuses: { dex: 2 }, speed: 25 },
        'gnome': { bonuses: { int: 2 }, speed: 25 },
        'half-elf': { bonuses: { cha: 2, "choose-2-stats": 1 }, speed: 30 },
        'half-orc': { bonuses: { str: 2, con: 1 }, speed: 30 },
        'tiefling': { bonuses: { cha: 2, int: 1 }, speed: 30 },
        'aarakocra': { bonuses: { dex: 2, wis: 1 }, speed: 25, fly: 50 },
        'aasimar': { bonuses: { cha: 2 }, speed: 30 },
        'bugbear': { bonuses: { str: 2, dex: 1 }, speed: 30 },
        'gith': { "choose-2-stats": 1, speed: 30 },
        'giff': { bonuses: { str: 2, con: 1 }, speed: 30 },
        'simic-hybrid': { bonuses: { con: 2, "choose-1-stat": 1 }, speed: 30 },
        'verdan': { bonuses: { cha: 2, con: 1 }, speed: 30 },
        'vedalken': { bonuses: { int: 2, wis: 1 }, speed: 30 },
        'autognome': { bonuses: { con: 1, int: 1, "choose-1-stat": 1 }, speed: 30 }
        // –î–æ–±–∞–≤—å –±–æ–ª—å—à–µ —Ä–∞—Å
      };

      const classHitDice = {
        '–≤–æ–∏–Ω': '1–∫10',
        '–º–∞–≥': '1–∫6',
        '–∂—Ä–µ—Ü': '1–∫8',
        '—Ä–∞–∑–±–æ–π–Ω–∏–∫': '1–∫8',
        '–ø–∞–ª–∞–¥–∏–Ω': '1–∫10',
        '—Å–ª–µ–¥–æ–ø—ã—Ç': '1–∫10',
        '–≤–∞—Ä–≤–∞—Ä': '1–∫12',
        '–¥—Ä—É–∏–¥': '1–∫8',
        '–±–∞—Ä–¥': '1–∫8',
        '—á–∞—Ä–æ–¥–µ–π': '1–∫6',
        '–∫–æ–ª–¥—É–Ω': '1–∫8',
        '–º–æ–Ω–∞—Ö': '1–∫8'
      };

      // --- State ---
      let currentCharId = null;
      let characters = JSON.parse(localStorage.getItem('dnd-characters')) || {};
      let currentAvatar = "https://via.placeholder.com/100x100/3a2a1a/d4af37?text=üë§";

      // --- Utility Functions ---
      function getMod(value) {
        return Math.floor((parseInt(value) - 10) / 2);
      }
      function formatMod(mod) {
        return mod >= 0 ? `+${mod}` : `${mod}`;
      }
      function getProficiencyBonus(level) {
        return Math.ceil(1 + (parseInt(level) || 1) / 4);
      }

      // --- Update Functions ---
      function updateRaceInfo() {
        const raceKey = raceSelect.value;
        const race = raceData[raceKey];
        if (race) {
          let bonusText = "";
          for (let stat in race.bonuses) {
            if (stat === 'choose') continue;
            bonusText += `+${race.bonuses[stat]} –∫ ${stat.toUpperCase()}, `;
          }
          if (race.bonuses["choose-2-stats"] === 1) {
            bonusText += `+1 –∫ –¥–≤—É–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –Ω–∞ –≤—ã–±–æ—Ä`;
          } else if (race.bonuses["choose-1-stat"] === 1) {
            bonusText += `+1 –∫ –æ–¥–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–µ –Ω–∞ –≤—ã–±–æ—Ä`;
          } else {
            bonusText = bonusText.slice(0, -2); // Remove trailing comma and space
          }
          // raceBonusInfo.textContent = bonusText || "-";
          baseSpeedInput.value = race.speed;
        } else {
          // raceBonusInfo.textContent = "-";
          baseSpeedInput.value = 30; // Default
        }
        updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –±–æ–Ω—É—Å—ã –∏–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å
      }

      function updateClassInfo() {
        const classKey = classSelect.value;
        const cls = classHitDice[classKey];
        if (cls) {
          hitDieInput.value = cls;
        } else {
          hitDieInput.value = "-";
        }
        updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è –ö–æ—Å—Ç—å –•–∏—Ç–æ–≤
      }

      function updateLevelInfo() {
        let val = parseInt(levelInput.value) || 1;
        val = Math.max(1, Math.min(20, val));
        levelInput.value = val;
        // profBonusSpan.textContent = formatMod(getProficiencyBonus(val));
        updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è –±–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞
      }

      function updateStatInputs() {
        const inputs = [strInput, dexInput, conInput, intInput, wisInput, chaInput];
        inputs.forEach(input => {
          let val = parseInt(input.value) || 10;
          val = Math.max(3, Math.min(20, val));
          input.value = val;
        });
        // Update mod displays next to inputs
        document.getElementById('str-mod').textContent = formatMod(getMod(strInput.value));
        document.getElementById('dex-mod').textContent = formatMod(getMod(dexInput.value));
        document.getElementById('con-mod').textContent = formatMod(getMod(conInput.value));
        document.getElementById('int-mod').textContent = formatMod(getMod(intInput.value));
        document.getElementById('wis-mod').textContent = formatMod(getMod(wisInput.value));
        document.getElementById('cha-mod').textContent = formatMod(getMod(chaInput.value));
        updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
      }

      function updateCombatInfo() {
        let speed = parseInt(baseSpeedInput.value) || 0;
        speed = Math.max(0, speed); // –ù–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
        baseSpeedInput.value = speed;
        calculatedSpeed.textContent = speed;
        preview.speed.textContent = speed;

        const dexMod = getMod(dexInput.value);
        calculatedInit.textContent = formatMod(dexMod);
        preview.init.textContent = formatMod(dexMod);

        const dexModFinal = getMod(dexInput.value);
        const ac = 10 + dexModFinal;
        calculatedAc.textContent = ac;
        preview.ac.textContent = ac;
      }

      function updateSummaryInfo() {
        preview.name.textContent = nameInput.value || "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞";
        preview.race.textContent = raceSelect.options[raceSelect.selectedIndex].text;
        preview.class.textContent = classSelect.options[classSelect.selectedIndex].text;
        preview.level.textContent = levelInput.value;
        preview.bg.textContent = bgInput.value || "-";
        preview.align.textContent = alignSelect.value;
        preview.hp.textContent = currentHpInput.value || "0";
        preview.maxHp.textContent = maxHpInput.value || "0";
        preview.ac.textContent = calculatedAc.textContent;
        preview.speed.textContent = calculatedSpeed.textContent;
        preview.init.textContent = calculatedInit.textContent;

        preview.strVal.textContent = strInput.value;
        preview.dexVal.textContent = dexInput.value;
        preview.conVal.textContent = conInput.value;
        preview.intVal.textContent = intInput.value;
        preview.wisVal.textContent = wisInput.value;
        preview.chaVal.textContent = chaInput.value;

        preview.strMod.textContent = formatMod(getMod(strInput.value));
        preview.dexMod.textContent = formatMod(getMod(dexInput.value));
        preview.conMod.textContent = formatMod(getMod(conInput.value));
        preview.intMod.textContent = formatMod(getMod(intInput.value));
        preview.wisMod.textContent = formatMod(getMod(wisInput.value));
        preview.chaMod.textContent = formatMod(getMod(chaInput.value));
      }

      function updateSavesAndSkills() {
        const strMod = getMod(strInput.value);
        const dexMod = getMod(dexInput.value);
        const conMod = getMod(conInput.value);
        const intMod = getMod(intInput.value);
        const wisMod = getMod(wisInput.value);
        const chaMod = getMod(chaInput.value);
        const profBonus = getProficiencyBonus(levelInput.value);

        const cls = classSelect.value || "–≤–æ–∏–Ω";
        const classSaves = {
          '–≤–æ–∏–Ω': ['str', 'con'],
          '–º–∞–≥': ['int'],
          '–∂—Ä–µ—Ü': ['wis', 'cha'],
          '—Ä–∞–∑–±–æ–π–Ω–∏–∫': ['dex', 'int'],
          '–ø–∞–ª–∞–¥–∏–Ω': ['wis', 'cha'],
          '—Å–ª–µ–¥–æ–ø—ã—Ç': ['str', 'dex'],
          '–≤–∞—Ä–≤–∞—Ä': ['str', 'con'],
          '–¥—Ä—É–∏–¥': ['int', 'wis'],
          '–±–∞—Ä–¥': ['dex', 'cha'],
          '—á–∞—Ä–æ–¥–µ–π': ['con', 'cha'],
          '–∫–æ–ª–¥—É–Ω': ['wis', 'cha'],
          '–º–æ–Ω–∞—Ö': ['str', 'dex']
        };

        const savesForClass = classSaves[cls] || [];

        // --- Update Saves Summary ---
        const savesHtml = `
          <li>–°–∏–ª: ${formatMod(strMod + (savesForClass.includes('str') ? profBonus : 0))}</li>
          <li>–õ–æ–≤: ${formatMod(dexMod + (savesForClass.includes('dex') ? profBonus : 0))}</li>
          <li>–¢–µ–ª: ${formatMod(conMod + (savesForClass.includes('con') ? profBonus : 0))}</li>
          <li>–ò–Ω—Ç: ${formatMod(intMod + (savesForClass.includes('int') ? profBonus : 0))}</li>
          <li>–ú–¥—Ä: ${formatMod(wisMod + (savesForClass.includes('wis') ? profBonus : 0))}</li>
          <li>–•–∞—Ä: ${formatMod(chaMod + (savesForClass.includes('cha') ? profBonus : 0))}</li>
        `;
        preview.savesList.innerHTML = savesHtml;

        // --- Update Skills Summary ---
        const skillStats = {
          'acrobatics': dexMod, 'animal-handling': wisMod, 'arcana': intMod,
          'athletics': strMod, 'deception': chaMod, 'history': intMod,
          'insight': wisMod, 'intimidation': chaMod, 'investigation': intMod,
          'medicine': wisMod, 'nature': intMod, 'perception': wisMod,
          'performance': chaMod, 'persuasion': chaMod, 'religion': intMod,
          'sleight-of-hand': dexMod, 'stealth': dexMod, 'survival': wisMod
        };
        let skillsList = [];
        for (let skill in skillCheckboxes) {
          if (skillCheckboxes[skill].checked) {
            const mod = skillStats[skill] + profBonus;
            // –ü–æ–ª—É—á–∞–µ–º —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è –Ω–∞–≤—ã–∫–∞ –∏–∑ –ª–µ–π–±–ª–∞
            const label = skillCheckboxes[skill].parentElement.textContent.trim().split(' (')[0];
            skillsList.push(`<li>${label}: ${formatMod(mod)}</li>`);
          } else {
            const mod = skillStats[skill];
            const label = skillCheckboxes[skill].parentElement.textContent.trim().split(' (')[0];
            skillsList.push(`<li>${label}: ${formatMod(mod)}</li>`);
          }
        }
        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ 4 —Å—Ç–æ–ª–±—Ü–∞: 5, 5, 5, 3
        const col1 = skillsList.slice(0, 5).join('');
        const col2 = skillsList.slice(5, 10).join('');
        const col3 = skillsList.slice(10, 15).join('');
        const col4 = skillsList.slice(15, 18).join('');

        preview.skillsList.innerHTML = `
          <li>${col1}</li>
          <li>${col2}</li>
          <li>${col3}</li>
          <li>${col4}</li>
        `;
      }

      function updateAll() {
        updateCombatInfo();
        updateSummaryInfo();
        updateSavesAndSkills();
      }

      // --- Character Management ---
      function populateCharSelector() {
        charSelector.innerHTML = '<option value="">-- –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ --</option>';
        for (let id in characters) {
          const option = document.createElement('option');
          option.value = id;
          option.textContent = characters[id].name || `–ü–µ—Ä—Å–æ–Ω–∞–∂ ${id.substring(0, 5)}`;
          charSelector.appendChild(option);
        }
        // –ï—Å–ª–∏ –±—ã–ª —Ç–µ–∫—É—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂, –≤—ã–±–µ—Ä–µ–º –µ–≥–æ
        if (currentCharId && characters[currentCharId]) {
          charSelector.value = currentCharId;
        }
      }

      function saveCurrentCharacter() {
        if (!currentCharId) {
          currentCharId = 'char_' + Date.now(); // –ü—Ä–æ—Å—Ç–æ–π ID
        }
        characters[currentCharId] = {
          id: currentCharId,
          name: nameInput.value,
          background: bgInput.value,
          alignment: alignSelect.value,
          exp: expInput.value,
          race: raceSelect.value,
          class: classSelect.value,
          level: levelInput.value,
          str: strInput.value,
          dex: dexInput.value,
          con: conInput.value,
          int: intInput.value,
          wis: wisInput.value,
          cha: chaInput.value,
          currentHp: currentHpInput.value,
          maxHp: maxHpInput.value,
          baseSpeed: baseSpeedInput.value,
          avatar: currentAvatar, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä
          hitDie: hitDieInput.value,
          // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
        };
        localStorage.setItem('dnd-characters', JSON.stringify(characters));
        populateCharSelector();
        charSelector.value = currentCharId; // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—É—â–∏–π
      }

      function loadCharacter(id) {
        const char = characters[id];
        if (!char) return;
        currentCharId = id;
        nameInput.value = char.name || "";
        bgInput.value = char.background || "";
        alignSelect.value = char.alignment || "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
        expInput.value = char.exp || "0";
        raceSelect.value = char.race || "human";
        classSelect.value = char.class || "–≤–æ–∏–Ω";
        levelInput.value = char.level || "1";
        strInput.value = char.str || "10";
        dexInput.value = char.dex || "10";
        conInput.value = char.con || "10";
        intInput.value = char.int || "10";
        wisInput.value = char.wis || "10";
        chaInput.value = char.cha || "10";
        currentHpInput.value = char.currentHp || "0";
        maxHpInput.value = char.maxHp || "0";
        baseSpeedInput.value = char.baseSpeed || "30";
        hitDieInput.value = char.hitDie || "";
        if (char.avatar) {
          currentAvatar = char.avatar;
          summaryAvatar.src = currentAvatar;
        }
        updateRaceInfo(); // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç updateAll
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤—ã–∫–æ–≤, –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
      }

      function newCharacter() {
        currentCharId = null;
        nameInput.value = "";
        bgInput.value = "";
        alignSelect.value = "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
        expInput.value = "0";
        raceSelect.value = "human";
        classSelect.value = "–≤–æ–∏–Ω";
        levelInput.value = "1";
        strInput.value = "10";
        dexInput.value = "10";
        conInput.value = "10";
        intInput.value = "10";
        wisInput.value = "10";
        chaInput.value = "10";
        currentHpInput.value = "0";
        maxHpInput.value = "0";
        baseSpeedInput.value = "30";
        hitDieInput.value = "";
        currentAvatar = "https://via.placeholder.com/100x100/3a2a1a/d4af37?text=üë§";
        summaryAvatar.src = currentAvatar;
        updateRaceInfo(); // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç updateAll
        charSelector.value = ""; // –í—ã–±–µ—Ä–µ—Ç "–ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂"
      }

      function deleteCharacter() {
        if (!currentCharId || !confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?")) return;
        delete characters[currentCharId];
        localStorage.setItem('dnd-characters', JSON.stringify(characters));
        newCharacter();
        populateCharSelector();
      }

      // --- Event Listeners ---
      charSelector.addEventListener('change', (e) => {
        const selectedId = e.target.value;
        if (selectedId) {
          loadCharacter(selectedId);
        } else {
          newCharacter();
        }
      });
      newCharBtn.addEventListener('click', newCharacter);
      deleteCharBtn.addEventListener('click', deleteCharacter);
      saveBtn.addEventListener('click', () => { saveCurrentCharacter(); alert("‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"); });
      exportTxtBtn.addEventListener('click', () => {
        // –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç
        let txt = `=== –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===\n`;
        txt += `–ò–º—è: ${nameInput.value || '–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞'}\n`;
        txt += `–†–∞—Å–∞: ${raceSelect.options[raceSelect.selectedIndex].text}\n`;
        txt += `–ö–ª–∞—Å—Å: ${classSelect.options[classSelect.selectedIndex].text}\n`;
        txt += `–£—Ä–æ–≤–µ–Ω—å: ${levelInput.value}\n`;
        txt += `–•–ü: ${currentHpInput.value || '0'}/${maxHpInput.value || '0'}\n`;
        txt += `–°–∫–æ—Ä–æ—Å—Ç—å: ${baseSpeedInput.value || '30'} —Ñ—É—Ç–æ–≤\n`;
        txt += `\n–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n`;
        txt += `–°–ò–õ: ${strInput.value} (${formatMod(getMod(strInput.value))})\n`;
        txt += `–õ–û–í: ${dexInput.value} (${formatMod(getMod(dexInput.value))})\n`;
        txt += `–¢–ï–õ: ${conInput.value} (${formatMod(getMod(conInput.value))})\n`;
        txt += `–ò–ù–¢: ${intInput.value} (${formatMod(getMod(intInput.value))})\n`;
        txt += `–ú–î–†: ${wisInput.value} (${formatMod(getMod(wisInput.value))})\n`;
        txt += `–•–ê–†: ${chaInput.value} (${formatMod(getMod(chaInput.value))})\n`;

        const blob = new Blob([txt], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${(nameInput.value || '–ø–µ—Ä—Å–æ–Ω–∞–∂').replace(/\s+/g, '_')}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      // --- Form Listeners ---
      nameInput.addEventListener('input', updateSummaryInfo);
      bgInput.addEventListener('input', updateSummaryInfo);
      alignSelect.addEventListener('change', updateSummaryInfo);
      expInput.addEventListener('input', () => { /* –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤ —Å–≤–æ–¥–∫–µ */ });

      raceSelect.addEventListener('change', updateRaceInfo);
      classSelect.addEventListener('change', updateClassInfo);
      levelInput.addEventListener('input', updateLevelInfo);

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º 'change' –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π –≤–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞
      strInput.addEventListener('change', updateStatInputs);
      dexInput.addEventListener('change', updateStatInputs);
      conInput.addEventListener('change', updateStatInputs);
      intInput.addEventListener('change', updateStatInputs);
      wisInput.addEventListener('change', updateStatInputs);
      chaInput.addEventListener('change', updateStatInputs);

      // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ input, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
      const statInputs = [strInput, dexInput, conInput, intInput, wisInput, chaInput];
      statInputs.forEach(input => {
        let timeoutId;
        input.addEventListener('input', () => {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => {
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            let val = parseInt(input.value) || 10;
            val = Math.max(3, Math.min(20, val));
            input.value = val;
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥ —Ä—è–¥–æ–º –∏ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
            updateStatInputs();
          }, 500); // –û–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞
        });
      });

      currentHpInput.addEventListener('input', updateSummaryInfo);
      maxHpInput.addEventListener('input', updateSummaryInfo);
      baseSpeedInput.addEventListener('input', () => {
        let val = parseInt(baseSpeedInput.value) || 0;
        val = Math.max(0, Math.min(200, val)); // –û–≥—Ä–∞–Ω–∏—á–∏–º —Å–≤–µ—Ä—Ö—É
        baseSpeedInput.value = val;
        updateCombatInfo();
      });

      // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ –Ω–∞–≤—ã–∫–æ–≤
      for (let skill in skillCheckboxes) {
        skillCheckboxes[skill].addEventListener('change', updateSavesAndSkills);
      }

      // --- Avatar Upload ---
      avatarUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            currentAvatar = e.target.result;
            summaryAvatar.src = currentAvatar;
            // –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ currentAvatar –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
          };
          reader.readAsDataURL(file);
        }
      });

      // --- Initial Setup ---
      populateCharSelector();
      updateRaceInfo(); // –≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
      updateClassInfo();
      updateLevelInfo();
      updateStatInputs();
    });
  </script>
</body>
</html>
