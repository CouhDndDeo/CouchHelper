<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" />
  <title>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
  <style>
    /* --- –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã --- */
    .char-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 900px) {
        .char-form-grid { grid-template-columns: 1fr; }
    }

    .form-section {
        background-color: #4a2f1a;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #8b6f47;
    }
    .form-section h3 {
        color: #d4af37;
        margin-top: 0;
        border-bottom: 1px solid #8b6f47;
        padding-bottom: 5px;
        margin-bottom: 10px;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
    }
    .form-row > label {
        flex: 1;
        min-width: 120px;
    }
    .form-row input, .form-row select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border-radius: 4px;
        border: 1px solid #8b6f47;
        background: #5a3b26;
        color: #e0ccb6;
    }

    .stats-section {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    .stat-box {
        text-align: center;
        background: #5a3b26;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #8b6f47;
    }
    .stat-box label { font-size: 0.9em; display: block; margin-bottom: 5px; }
    .stat-box input {
        width: 100%;
        text-align: center;
        font-weight: bold;
        font-size: 1.1em;
        padding: 5px;
        max-width: 70px;
        margin: 0 auto;
    }
    .stat-mod { font-size: 0.9em; color: #b8a594; }

    .skills-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .skills-grid li { font-size: 0.9em; }
    .skills-grid label {
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .skills-grid input { margin-right: 5px; transform: scale(1.1); }

    /* --- –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–æ–¥–∫–∏ (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä) --- */
    .char-summary {
        background: linear-gradient(145deg, #5a3b26, #4a2e1a);
        border: 2px solid #8b6f47;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 6px 0 #3a2410, 0 6px 15px rgba(0, 0, 0, 0.5);
        text-align: center;
        position: relative; /* –î–ª—è –∞–≤–∞—Ç–∞—Ä–∞ */
    }
    .avatar-container {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 2px solid #d4af37;
        overflow: hidden;
        margin: 0 auto 15px;
        background-color: #3a2410;
    }
    .avatar-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .summary-name {
        font-size: 1.8em;
        color: #f0d98f;
        margin: 10px 0;
    }
    .summary-details {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 0.95em;
        margin-bottom: 20px;
    }
    .summary-details > div { border-right: 1px solid #8b6f47; padding: 0 10px; }
    .summary-details > div:last-child { border-right: none; }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 20px 0;
    }
    .summary-stat {
        background: rgba(0, 0, 0, 0.2);
        padding: 10px 5px;
        border-radius: 6px;
        border: 1px solid #5a3b26;
    }
    .summary-stat-name { font-size: 0.8em; color: #b8a594; }
    .summary-stat-value { font-size: 1.4em; font-weight: bold; color: #f0d98f; }
    .summary-stat-mod { font-size: 0.9em; color: #d4af37; }

    .summary-combat {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        font-size: 0.95em;
    }

    .summary-quick-info {
        text-align: left;
        margin-top: 20px;
        font-size: 0.9em;
    }
    .summary-quick-info h4 {
        color: #d4af37;
        border-bottom: 1px solid #8b6f47;
        padding-bottom: 3px;
        margin: 10px 0 5px;
    }
    .summary-quick-info ul {
        list-style-type: none;
        padding-left: 10px;
        margin: 0;
        columns: 2;
        column-gap: 20px;
    }
    .summary-quick-info li { margin-bottom: 3px; }

    /* --- –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ --- */
    .char-manager {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }
    .char-manager select {
        flex-grow: 1;
        max-width: 300px;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #8b6f47;
        background: #5a3b26;
        color: #e0ccb6;
    }
    .char-manager button {
        padding: 8px 12px;
        border-radius: 4px;
        border: none;
        background: #5a3b26;
        color: #d4af37;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
    }
    .char-manager button:hover { background: #6b4426; }

    /* --- –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ --- */
    #avatar-upload {
        width: 100%;
        padding: 5px;
        font-size: 0.8em;
    }

     /* --- –û—Å–Ω–æ–≤–Ω–æ–π –º–∞–∫–µ—Ç --- */
     .sheet-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin: 20px 0;
      }
      @media (max-width: 900px) {
        .sheet-layout { grid-template-columns: 1fr; }
      }
      .sheet-form h2 {
        color: #d4af37;
        margin-bottom: 15px;
        border-left: 5px solid #d4af37;
        padding-left: 10px;
      }
      .form-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
      }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h1>
      <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º D&D 5e</p>
    </header>

    <nav>
      <a href="dnd.html" class="btn-back">
        <span class="arrow">‚Üê</span>
        <span class="text">–í –º–µ–Ω—é D&D</span>
      </a>
    </nav>

    <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π -->
    <div class="char-manager">
        <select id="char-selector">
            <option value="">-- –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ --</option>
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </select>
        <button id="new-char-btn">–ù–æ–≤—ã–π</button>
        <button id="delete-char-btn">–£–¥–∞–ª–∏—Ç—å</button>
        <button id="export-txt-btn">–≠–∫—Å–ø–æ—Ä—Ç (.txt)</button>
        <!-- <button id="export-pdf-btn">–≠–∫—Å–ø–æ—Ä—Ç (.pdf)</button> --> <!-- –ó–∞–≥–ª—É—à–∫–∞ -->
    </div>

    <main class="sheet-layout">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
        <section class="sheet-form">
            <h2>üßô‚Äç‚ôÇÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
            <div class="char-form-grid">
                <!-- –ë–∞–∑–æ–≤–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="form-section">
                    <h3>–û–±—â–µ–µ</h3>
                    <div class="form-row">
                        <label>–ò–º—è: <input type="text" id="char-name"></label>
                        <label>–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è: <input type="text" id="char-background"></label>
                    </div>
                    <div class="form-row">
                        <label>–ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:
                            <select id="char-alignment">
                                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π</option>
                                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
                                <option value="–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π">–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π</option>
                                <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π</option>
                                <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π">–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π</option>
                            </select>
                        </label>
                         <label>–û–ø—ã—Ç: <input type="number" id="char-exp" value="0" min="0"></label>
                    </div>
                    <div class="form-row">
                        <label>–ê–≤–∞—Ç–∞—Ä: <input type="file" id="avatar-upload" accept="image/*"></label>
                    </div>
                </div>

                <!-- –†–∞—Å–∞ –∏ –ö–ª–∞—Å—Å -->
                <div class="form-section">
                    <h3>–†–∞—Å–∞ –∏ –ö–ª–∞—Å—Å</h3>
                    <div class="form-row">
                        <label>–†–∞—Å–∞:
                            <select id="char-race">
                                <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
                                <option value="elf">–≠–ª—å—Ñ</option>
                                <option value="dwarf">–î–≤–∞—Ä—Ñ</option>
                                <option value="halfling">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫</option>
                                <option value="gnome">–ì–Ω–æ–º</option>
                                <option value="half-elf">–ü–æ–ª—É—ç–ª—å—Ñ</option>
                                <option value="half-orc">–ü–æ–ª—É–æ—Ä–∫</option>
                                <option value="tiefling">–¢–∏—Ñ–ª–∏–Ω–≥</option>
                                <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ -->
                            </select>
                        </label>
                        <label>–ö–ª–∞—Å—Å:
                            <select id="char-class">
                                <option value="barbarian">–í–∞—Ä–≤–∞—Ä</option>
                                <option value="bard">–ë–∞—Ä–¥</option>
                                <option value="cleric">–ñ—Ä–µ—Ü</option>
                                <option value="druid">–î—Ä—É–∏–¥</option>
                                <option value="fighter">–í–æ–∏–Ω</option>
                                <option value="monk">–ú–æ–Ω–∞—Ö</option>
                                <option value="paladin">–ü–∞–ª–∞–¥–∏–Ω</option>
                                <option value="ranger">–°–ª–µ–¥–æ–ø—ã—Ç</option>
                                <option value="rogue">–†–∞–∑–±–æ–π–Ω–∏–∫</option>
                                <option value="sorcerer">–ß–∞—Ä–æ–¥–µ–π</option>
                                <option value="warlock">–ö–æ–ª–¥—É–Ω</option>
                                <option value="wizard">–ú–∞–≥</option>
                            </select>
                        </label>
                         <label>–£—Ä–æ–≤–µ–Ω—å: <input type="number" id="char-level" value="1" min="1" max="20"></label>
                    </div>
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –±–æ–Ω—É—Å–æ–≤ -->
                    <div style="font-size: 0.85em; color: #b8a594; margin-top: 10px;">
                        <strong>–ë–æ–Ω—É—Å—ã —Ä–∞—Å—ã:</strong> <span id="race-bonus-info">-</span><br>
                        <strong>–ö–æ—Å—Ç—å –•–∏—Ç–æ–≤:</strong> <span id="hit-die-info">-</span>
                    </div>
                </div>

                <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                <div class="form-section">
                    <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
                    <div class="stats-section">
                        <div class="stat-box">
                            <label for="str">–°–ò–õ</label>
                            <input type="number" id="str" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="str-mod">+0</span>)</div>
                        </div>
                        <div class="stat-box">
                            <label for="dex">–õ–û–í</label>
                            <input type="number" id="dex" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="dex-mod">+0</span>)</div>
                        </div>
                        <div class="stat-box">
                            <label for="con">–¢–ï–õ</label>
                            <input type="number" id="con" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="con-mod">+0</span>)</div>
                        </div>
                        <div class="stat-box">
                            <label for="int">–ò–ù–¢</label>
                            <input type="number" id="int" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="int-mod">+0</span>)</div>
                        </div>
                        <div class="stat-box">
                            <label for="wis">–ú–î–†</label>
                            <input type="number" id="wis" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="wis-mod">+0</span>)</div>
                        </div>
                        <div class="stat-box">
                            <label for="cha">–•–ê–†</label>
                            <input type="number" id="cha" min="3" max="20" value="10">
                            <div class="stat-mod">(<span id="cha-mod">+0</span>)</div>
                        </div>
                    </div>
                </div>

                <!-- –ë–æ–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="form-section">
                    <h3>–ë–æ–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
                    <div class="form-row">
                        <label>–¢–µ–∫—É—â–∏–µ –•–ü: <input type="number" id="current-hp" value="0" min="0"></label>
                        <label>–ú–∞–∫—Å. –•–ü: <input type="number" id="max-hp" value="0" min="0"></label>
                        <label>–ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: <input type="number" id="base-speed" value="30" min="0"></label>
                    </div>
                    <div style="font-size: 0.9em; color: #b8a594;">
                        <strong>–ö–î (–±–µ–∑ –¥–æ—Å–ø–µ—Ö–∞):</strong> <span id="calculated-ac">10</span> |
                        <strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> <span id="calculated-speed">30</span> —Ñ—Ç. |
                        <strong>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:</strong> <span id="calculated-init">+0</span> |
                        <strong>–ë–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞:</strong> <span id="prof-bonus">+2</span>
                    </div>
                </div>

                <!-- –ù–∞–≤—ã–∫–∏ -->
                <div class="form-section" style="grid-column: span 2;">
                    <h3>–ù–∞–≤—ã–∫–∏</h3>
                    <ul class="skills-grid">
                        <li><label><input type="checkbox" id="skill-acrobatics"> –ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞ (–õ–æ–≤)</label></li>
                        <li><label><input type="checkbox" id="skill-animal-handling"> –£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏ (–ú–¥—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-arcana"> –ú–∞–≥–∏—è (–ò–Ω—Ç)</label></li>
                        <li><label><input type="checkbox" id="skill-athletics"> –ê—Ç–ª–µ—Ç–∏–∫–∞ (–°–∏–ª)</label></li>
                        <li><label><input type="checkbox" id="skill-deception"> –û–±–º–∞–Ω (–•–∞—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-history"> –ò—Å—Ç–æ—Ä–∏—è (–ò–Ω—Ç)</label></li>
                        <li><label><input type="checkbox" id="skill-insight"> –ü—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ú–¥—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-intimidation"> –ó–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ (–•–∞—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-investigation"> –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–ò–Ω—Ç)</label></li>
                        <li><label><input type="checkbox" id="skill-medicine"> –ú–µ–¥–∏—Ü–∏–Ω–∞ (–ú–¥—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-nature"> –ü—Ä–∏—Ä–æ–¥–∞ (–ò–Ω—Ç)</label></li>
                        <li><label><input type="checkbox" id="skill-perception"> –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ (–ú–¥—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-performance"> –í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ (–•–∞—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-persuasion"> –£–±–µ–∂–¥–µ–Ω–∏–µ (–•–∞—Ä)</label></li>
                        <li><label><input type="checkbox" id="skill-religion"> –†–µ–ª–∏–≥–∏—è (–ò–Ω—Ç)</label></li>
                        <li><label><input type="checkbox" id="skill-sleight-of-hand"> –õ–æ–≤–∫–æ—Å—Ç—å —Ä—É–∫ (–õ–æ–≤)</label></li>
                        <li><label><input type="checkbox" id="skill-stealth"> –°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å (–õ–æ–≤)</label></li>
                        <li><label><input type="checkbox" id="skill-survival"> –í—ã–∂–∏–≤–∞–Ω–∏–µ (–ú–¥—Ä)</label></li>
                    </ul>
                </div>
            </div>

            <div class="form-buttons">
                <button id="save-char-btn" class="btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                 <!-- <button id="reset-form-btn" class="btn-clear">üîÑ –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã</button> --> <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å -->
            </div>
        </section>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–≤–æ–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
        <section class="sheet-preview">
            <h2>üìñ –°–≤–æ–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
            <div class="char-summary">
                <div class="avatar-container">
                    <img id="summary-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%233a2410'/%3E%3C/svg%3E" alt="–ê–≤–∞—Ç–∞—Ä">
                </div>
                <div class="summary-name" id="summary-name">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
                <div class="summary-details">
                    <div><strong>–†–∞—Å–∞:</strong> <span id="summary-race">-</span></div>
                    <div><strong>–ö–ª–∞—Å—Å:</strong> <span id="summary-class">-</span></div>
                    <div><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="summary-level">1</span></div>
                    <div><strong>–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è:</strong> <span id="summary-bg">-</span></div>
                    <div><strong>–ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:</strong> <span id="summary-align">-</span></div>
                </div>

                <div class="summary-combat">
                    <div><strong>–ö–î:</strong> <span id="summary-ac">10</span></div>
                    <div><strong>–•–ü:</strong> <span id="summary-hp">0</span>/<span id="summary-max-hp">0</span></div>
                    <div><strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> <span id="summary-speed">30</span> —Ñ—Ç.</div>
                    <div><strong>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:</strong> <span id="summary-init">+0</span></div>
                </div>

                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-name">–°–ò–õ</div>
                        <div class="summary-stat-value" id="summary-str-val">10</div>
                        <div class="summary-stat-mod" id="summary-str-mod">+0</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-name">–õ–û–í</div>
                        <div class="summary-stat-value" id="summary-dex-val">10</div>
                        <div class="summary-stat-mod" id="summary-dex-mod">+0</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-name">–¢–ï–õ</div>
                        <div class="summary-stat-value" id="summary-con-val">10</div>
                        <div class="summary-stat-mod" id="summary-con-mod">+0</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-name">–ò–ù–¢</div>
                        <div class="summary-stat-value" id="summary-int-val">10</div>
                        <div class="summary-stat-mod" id="summary-int-mod">+0</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-name">–ú–î–†</div>
                        <div class="summary-stat-value" id="summary-wis-val">10</div>
                        <div class="summary-stat-mod" id="summary-wis-mod">+0</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-name">–•–ê–†</div>
                        <div class="summary-stat-value" id="summary-cha-val">10</div>
                        <div class="summary-stat-mod" id="summary-cha-mod">+0</div>
                    </div>
                </div>

                <div class="summary-quick-info">
                    <h4>–ö–ª—é—á–µ–≤—ã–µ —Å–ø–∞—Å–±—Ä–æ—Å–∫–∏</h4>
                    <ul id="summary-saves">
                        <li>–°–∏–ª: +0</li>
                        <li>–õ–æ–≤: +0</li>
                        <li>–¢–µ–ª: +0</li>
                        <li>–ò–Ω—Ç: +0</li>
                        <li>–ú–¥—Ä: +0</li>
                        <li>–•–∞—Ä: +0</li>
                    </ul>
                    <h4>–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏</h4>
                    <ul id="summary-skills">
                         <li>–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ: +0</li>
                         <li>–ê—Ç–ª–µ—Ç–∏–∫–∞: +0</li>
                         <li>... (–≤—ã–±–µ—Ä–∏—Ç–µ –≤ —Ñ–æ—Ä–º–µ)</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer>
      <p>–õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è D&D 5e</p>
    </footer>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const charSelector = document.getElementById('char-selector');
        const newCharBtn = document.getElementById('new-char-btn');
        const deleteCharBtn = document.getElementById('delete-char-btn');
        const exportTxtBtn = document.getElementById('export-txt-btn');
        // const exportPdfBtn = document.getElementById('export-pdf-btn'); // –ó–∞–≥–ª—É—à–∫–∞

        const nameInput = document.getElementById('char-name');
        const bgInput = document.getElementById('char-background');
        const alignSelect = document.getElementById('char-alignment');
        const expInput = document.getElementById('char-exp');
        const avatarUpload = document.getElementById('avatar-upload');

        const raceSelect = document.getElementById('char-race');
        const classSelect = document.getElementById('char-class');
        const levelInput = document.getElementById('char-level');

        const strInput = document.getElementById('str');
        const dexInput = document.getElementById('dex');
        const conInput = document.getElementById('con');
        const intInput = document.getElementById('int');
        const wisInput = document.getElementById('wis');
        const chaInput = document.getElementById('cha');

        const currentHpInput = document.getElementById('current-hp');
        const maxHpInput = document.getElementById('max-hp');
        const baseSpeedInput = document.getElementById('base-speed');

        const saveCharBtn = document.getElementById('save-char-btn');

        // --- Summary Elements ---
        const summaryAvatar = document.getElementById('summary-avatar');
        const summaryName = document.getElementById('summary-name');
        const summaryRace = document.getElementById('summary-race');
        const summaryClass = document.getElementById('summary-class');
        const summaryLevel = document.getElementById('summary-level');
        const summaryBg = document.getElementById('summary-bg');
        const summaryAlign = document.getElementById('summary-align');
        const summaryAc = document.getElementById('summary-ac');
        const summaryHp = document.getElementById('summary-hp');
        const summaryMaxHp = document.getElementById('summary-max-hp');
        const summarySpeed = document.getElementById('summary-speed');
        const summaryInit = document.getElementById('summary-init');
        const summaryStrVal = document.getElementById('summary-str-val');
        const summaryDexVal = document.getElementById('summary-dex-val');
        const summaryConVal = document.getElementById('summary-con-val');
        const summaryIntVal = document.getElementById('summary-int-val');
        const summaryWisVal = document.getElementById('summary-wis-val');
        const summaryChaVal = document.getElementById('summary-cha-val');
        const summaryStrMod = document.getElementById('summary-str-mod');
        const summaryDexMod = document.getElementById('summary-dex-mod');
        const summaryConMod = document.getElementById('summary-con-mod');
        const summaryIntMod = document.getElementById('summary-int-mod');
        const summaryWisMod = document.getElementById('summary-wis-mod');
        const summaryChaMod = document.getElementById('summary-cha-mod');
        const summarySaves = document.getElementById('summary-saves');
        const summarySkills = document.getElementById('summary-skills');

        // --- Info/Calculation Elements ---
        const raceBonusInfo = document.getElementById('race-bonus-info');
        const hitDieInfo = document.getElementById('hit-die-info');
        const strModSpan = document.getElementById('str-mod');
        const dexModSpan = document.getElementById('dex-mod');
        const conModSpan = document.getElementById('con-mod');
        const intModSpan = document.getElementById('int-mod');
        const wisModSpan = document.getElementById('wis-mod');
        const chaModSpan = document.getElementById('cha-mod');
        const calculatedAc = document.getElementById('calculated-ac');
        const calculatedSpeed = document.getElementById('calculated-speed');
        const calculatedInit = document.getElementById('calculated-init');
        const profBonusSpan = document.getElementById('prof-bonus');

        // --- Skill Checkboxes ---
        const skillCheckboxes = {
            'acrobatics': document.getElementById('skill-acrobatics'),
            'animal-handling': document.getElementById('skill-animal-handling'),
            'arcana': document.getElementById('skill-arcana'),
            'athletics': document.getElementById('skill-athletics'),
            'deception': document.getElementById('skill-deception'),
            'history': document.getElementById('skill-history'),
            'insight': document.getElementById('skill-insight'),
            'intimidation': document.getElementById('skill-intimidation'),
            'investigation': document.getElementById('skill-investigation'),
            'medicine': document.getElementById('skill-medicine'),
            'nature': document.getElementById('skill-nature'),
            'perception': document.getElementById('skill-perception'),
            'performance': document.getElementById('skill-performance'),
            'persuasion': document.getElementById('skill-persuasion'),
            'religion': document.getElementById('skill-religion'),
            'sleight-of-hand': document.getElementById('skill-sleight-of-hand'),
            'stealth': document.getElementById('skill-stealth'),
            'survival': document.getElementById('skill-survival')
        };

        // --- Data ---
        const raceData = {
            'human': { bonuses: { str: 1, dex: 1, con: 1, int: 1, wis: 1, cha: 1 }, speed: 30 },
            'elf': { bonuses: { dex: 2 }, speed: 30 },
            'dwarf': { bonuses: { con: 2 }, speed: 25 },
            'halfling': { bonuses: { dex: 2 }, speed: 25 },
            'gnome': { bonuses: { int: 2 }, speed: 25 },
            'half-elf': { bonuses: { cha: 2, choose: 2 }, speed: 30 }, // choose: 2 means player chooses 2 stats to +1
            'half-orc': { bonuses: { str: 2, con: 1 }, speed: 30 },
            'tiefling': { bonuses: { cha: 2, int: 1 }, speed: 30 }
             // –î–æ–±–∞–≤—å –±–æ–ª—å—à–µ —Ä–∞—Å
        };

        const classData = {
             'barbarian': { hd: '1–∫12', saves: ['str', 'con'] },
             'bard': { hd: '1–∫8', saves: ['dex', 'cha'] },
             'cleric': { hd: '1–∫8', saves: ['wis', 'cha'] },
             'druid': { hd: '1–∫8', saves: ['int', 'wis'] },
             'fighter': { hd: '1–∫10', saves: ['str', 'con'] },
             'monk': { hd: '1–∫8', saves: ['str', 'dex'] },
             'paladin': { hd: '1–∫10', saves: ['wis', 'cha'] },
             'ranger': { hd: '1–∫10', saves: ['str', 'dex'] },
             'rogue': { hd: '1–∫8', saves: ['dex', 'int'] },
             'sorcerer': { hd: '1–∫6', saves: ['con', 'cha'] },
             'warlock': { hd: '1–∫8', saves: ['wis', 'cha'] },
             'wizard': { hd: '1–∫6', saves: ['int', 'wis'] }
        };


        // --- State ---
        let currentCharId = null;
        let characters = JSON.parse(localStorage.getItem('dnd-characters')) || {};
        let currentAvatar = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%233a2410'/%3E%3C/svg%3E"; // Default avatar

        // --- Utility Functions ---
        function getMod(value) {
            return Math.floor((parseInt(value) - 10) / 2);
        }
        function formatMod(mod) {
            return mod >= 0 ? `+${mod}` : `${mod}`;
        }
        function getProficiencyBonus(level) {
             return Math.ceil(1 + (parseInt(level) / 4));
        }

        // --- Update Functions ---
        function updateRaceInfo() {
            const raceKey = raceSelect.value;
            const race = raceData[raceKey];
            if (race) {
                let bonusText = "";
                for (let stat in race.bonuses) {
                    if (stat === 'choose') continue;
                    bonusText += `+${race.bonuses[stat]} –∫ ${stat.toUpperCase()}, `;
                }
                if (race.bonuses.choose) {
                    bonusText += `+1 –∫ ${race.bonuses.choose} —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –Ω–∞ –≤—ã–±–æ—Ä`;
                } else {
                    bonusText = bonusText.slice(0, -2); // Remove trailing comma and space
                }
                raceBonusInfo.textContent = bonusText || "-";
                baseSpeedInput.value = race.speed;
            } else {
                raceBonusInfo.textContent = "-";
                baseSpeedInput.value = 30; // Default
            }
            updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –±–æ–Ω—É—Å—ã –∏–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å
        }

        function updateClassInfo() {
            const classKey = classSelect.value;
            const cls = classData[classKey];
            if (cls) {
                hitDieInfo.textContent = cls.hd;
            } else {
                hitDieInfo.textContent = "-";
            }
            updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –º–æ–≥ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ö–æ—Å—Ç—å –•–∏—Ç–æ–≤
        }

        function updateLevelInfo() {
             let val = parseInt(levelInput.value) || 1;
             val = Math.max(1, Math.min(20, val));
             levelInput.value = val;
             profBonusSpan.textContent = formatMod(getProficiencyBonus(val));
             updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è –±–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞
        }

        function updateStatInputs() {
             const inputs = [strInput, dexInput, conInput, intInput, wisInput, chaInput];
             inputs.forEach(input => {
                 let val = parseInt(input.value) || 10;
                 val = Math.max(3, Math.min(20, val));
                 input.value = val;
             });
             // Update mod displays next to inputs
             strModSpan.textContent = formatMod(getMod(strInput.value));
             dexModSpan.textContent = formatMod(getMod(dexInput.value));
             conModSpan.textContent = formatMod(getMod(conInput.value));
             intModSpan.textContent = formatMod(getMod(intInput.value));
             wisModSpan.textContent = formatMod(getMod(wisInput.value));
             chaModSpan.textContent = formatMod(getMod(chaInput.value));
             updateAll(); // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        }

        function updateCombatInfo() {
             let speed = parseInt(baseSpeedInput.value) || 0;
             speed = Math.max(0, speed); // –ù–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
             baseSpeedInput.value = speed;
             calculatedSpeed.textContent = speed;
             summarySpeed.textContent = speed;

             const dexMod = getMod(dexInput.value);
             calculatedInit.textContent = formatMod(dexMod);
             summaryInit.textContent = formatMod(dexMod);

             const dexModFinal = getMod(dexInput.value);
             const ac = 10 + dexModFinal;
             calculatedAc.textContent = ac;
             summaryAc.textContent = ac;
        }

        function updateSummaryInfo() {
            summaryName.textContent = nameInput.value || "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞";
            summaryRace.textContent = raceSelect.options[raceSelect.selectedIndex].text;
            summaryClass.textContent = classSelect.options[classSelect.selectedIndex].text;
            summaryLevel.textContent = levelInput.value;
            summaryBg.textContent = bgInput.value || "-";
            summaryAlign.textContent = alignSelect.value;
            summaryHp.textContent = currentHpInput.value || "0";
            summaryMaxHp.textContent = maxHpInput.value || "0";

            summaryStrVal.textContent = strInput.value;
            summaryDexVal.textContent = dexInput.value;
            summaryConVal.textContent = conInput.value;
            summaryIntVal.textContent = intInput.value;
            summaryWisVal.textContent = wisInput.value;
            summaryChaVal.textContent = chaInput.value;

            summaryStrMod.textContent = formatMod(getMod(strInput.value));
            summaryDexMod.textContent = formatMod(getMod(dexInput.value));
            summaryConMod.textContent = formatMod(getMod(conInput.value));
            summaryIntMod.textContent = formatMod(getMod(intInput.value));
            summaryWisMod.textContent = formatMod(getMod(wisInput.value));
            summaryChaMod.textContent = formatMod(getMod(chaInput.value));
        }

        function updateSavesAndSkills() {
             const strMod = getMod(strInput.value);
             const dexMod = getMod(dexInput.value);
             const conMod = getMod(conInput.value);
             const intMod = getMod(intInput.value);
             const wisMod = getMod(wisInput.value);
             const chaMod = getMod(chaInput.value);
             const profBonus = getProficiencyBonus(levelInput.value);

             const cls = classData[classSelect.value] || { saves: [] };

             // --- Update Saves Summary ---
             const savesHtml = `
                 <li>–°–∏–ª: ${formatMod(strMod + (cls.saves.includes('str') ? profBonus : 0))}</li>
                 <li>–õ–æ–≤: ${formatMod(dexMod + (cls.saves.includes('dex') ? profBonus : 0))}</li>
                 <li>–¢–µ–ª: ${formatMod(conMod + (cls.saves.includes('con') ? profBonus : 0))}</li>
                 <li>–ò–Ω—Ç: ${formatMod(intMod + (cls.saves.includes('int') ? profBonus : 0))}</li>
                 <li>–ú–¥—Ä: ${formatMod(wisMod + (cls.saves.includes('wis') ? profBonus : 0))}</li>
                 <li>–•–∞—Ä: ${formatMod(chaMod + (cls.saves.includes('cha') ? profBonus : 0))}</li>
             `;
             summarySaves.innerHTML = savesHtml;

             // --- Update Skills Summary ---
             const skillStats = {
                 'acrobatics': dexMod, 'animal-handling': wisMod, 'arcana': intMod,
                 'athletics': strMod, 'deception': chaMod, 'history': intMod,
                 'insight': wisMod, 'intimidation': chaMod, 'investigation': intMod,
                 'medicine': wisMod, 'nature': intMod, 'perception': wisMod,
                 'performance': chaMod, 'persuasion': chaMod, 'religion': intMod,
                 'sleight-of-hand': dexMod, 'stealth': dexMod, 'survival': wisMod
             };
             let skillsList = [];
             for (let skill in skillCheckboxes) {
                 if (skillCheckboxes[skill].checked) {
                     const mod = skillStats[skill] + profBonus;
                     // –ü–æ–ª—É—á–∞–µ–º —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è –Ω–∞–≤—ã–∫–∞ –∏–∑ –ª–µ–π–±–ª–∞
                     const label = skillCheckboxes[skill].parentElement.textContent.trim().split(' (')[0];
                     skillsList.push(`${label}: ${formatMod(mod)}`);
                 }
             }
             if (skillsList.length === 0) {
                 summarySkills.innerHTML = "<li>... (–≤—ã–±–µ—Ä–∏—Ç–µ –≤ —Ñ–æ—Ä–º–µ)</li>";
             } else {
                 // –ü–æ–∫–∞–∂–µ–º –¥–æ 4 –Ω–∞–≤—ã–∫–æ–≤
                 const displaySkills = skillsList.slice(0, 4);
                 summarySkills.innerHTML = displaySkills.map(s => `<li>${s}</li>`).join('');
             }
        }


        function updateAll() {
            updateCombatInfo();
            updateSummaryInfo();
            updateSavesAndSkills();
        }

        // --- Character Management ---
        function populateCharSelector() {
            charSelector.innerHTML = '<option value="">-- –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ --</option>';
            for (let id in characters) {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = characters[id].name || `–ü–µ—Ä—Å–æ–Ω–∞–∂ ${id.substring(0, 5)}`;
                charSelector.appendChild(option);
            }
            // –ï—Å–ª–∏ –±—ã–ª —Ç–µ–∫—É—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂, –≤—ã–±–µ—Ä–µ–º –µ–≥–æ
            if (currentCharId && characters[currentCharId]) {
                charSelector.value = currentCharId;
            }
        }

        function saveCurrentCharacter() {
            if (!currentCharId) {
                currentCharId = 'char_' + Date.now(); // –ü—Ä–æ—Å—Ç–æ–π ID
            }
            characters[currentCharId] = {
                id: currentCharId,
                name: nameInput.value,
                background: bgInput.value,
                alignment: alignSelect.value,
                exp: expInput.value,
                race: raceSelect.value,
                class: classSelect.value,
                level: levelInput.value,
                str: strInput.value,
                dex: dexInput.value,
                con: conInput.value,
                int: intInput.value,
                wis: wisInput.value,
                cha: chaInput.value,
                currentHp: currentHpInput.value,
                maxHp: maxHpInput.value,
                baseSpeed: baseSpeedInput.value,
                avatar: currentAvatar, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä
                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
            };
            localStorage.setItem('dnd-characters', JSON.stringify(characters));
            populateCharSelector();
            charSelector.value = currentCharId; // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—É—â–∏–π
        }

        function loadCharacter(id) {
            const char = characters[id];
            if (!char) return;
            currentCharId = id;
            nameInput.value = char.name || "";
            bgInput.value = char.background || "";
            alignSelect.value = char.alignment || "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
            expInput.value = char.exp || "0";
            raceSelect.value = char.race || "human";
            classSelect.value = char.class || "fighter";
            levelInput.value = char.level || "1";
            strInput.value = char.str || "10";
            dexInput.value = char.dex || "10";
            conInput.value = char.con || "10";
            intInput.value = char.int || "10";
            wisInput.value = char.wis || "10";
            chaInput.value = char.cha || "10";
            currentHpInput.value = char.currentHp || "0";
            maxHpInput.value = char.maxHp || "0";
            baseSpeedInput.value = char.baseSpeed || "30";
            if (char.avatar) {
                currentAvatar = char.avatar;
                summaryAvatar.src = currentAvatar;
            }
            updateRaceInfo(); // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç updateAll
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤—ã–∫–æ–≤, –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
        }

        function newCharacter() {
            currentCharId = null;
            nameInput.value = "";
            bgInput.value = "";
            alignSelect.value = "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
            expInput.value = "0";
            raceSelect.value = "human";
            classSelect.value = "fighter";
            levelInput.value = "1";
            strInput.value = "10";
            dexInput.value = "10";
            conInput.value = "10";
            intInput.value = "10";
            wisInput.value = "10";
            chaInput.value = "10";
            currentHpInput.value = "0";
            maxHpInput.value = "0";
            baseSpeedInput.value = "30";
            currentAvatar = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%233a2410'/%3E%3C/svg%3E";
            summaryAvatar.src = currentAvatar;
            updateRaceInfo(); // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç updateAll
            charSelector.value = ""; // –í—ã–±–µ—Ä–µ—Ç "–ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂"
        }

        function deleteCharacter() {
            if (!currentCharId || !confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?")) return;
            delete characters[currentCharId];
            localStorage.setItem('dnd-characters', JSON.stringify(characters));
            newCharacter();
            populateCharSelector();
        }

        // --- Event Listeners ---
        charSelector.addEventListener('change', (e) => {
             const selectedId = e.target.value;
             if (selectedId) {
                 loadCharacter(selectedId);
             } else {
                 newCharacter();
             }
        });
        newCharBtn.addEventListener('click', newCharacter);
        deleteCharBtn.addEventListener('click', deleteCharacter);
        saveCharBtn.addEventListener('click', () => { saveCurrentCharacter(); alert("–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"); });
        exportTxtBtn.addEventListener('click', () => {
             // –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç
             let txt = `–ò–º—è: ${nameInput.value || '–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞'}\n`;
             txt += `–†–∞—Å–∞: ${raceSelect.options[raceSelect.selectedIndex].text}\n`;
             txt += `–ö–ª–∞—Å—Å: ${classSelect.options[classSelect.selectedIndex].text}\n`;
             txt += `–£—Ä–æ–≤–µ–Ω—å: ${levelInput.value}\n`;
             txt += `–•–ü: ${currentHpInput.value || '0'}/${maxHpInput.value || '0'}\n`;
             txt += `–°–∫–æ—Ä–æ—Å—Ç—å: ${baseSpeedInput.value || '30'} —Ñ—Ç.\n`;
             txt += `\n–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n`;
             txt += `–°–ò–õ: ${strInput.value} (${formatMod(getMod(strInput.value))})\n`;
             txt += `–õ–û–í: ${dexInput.value} (${formatMod(getMod(dexInput.value))})\n`;
             txt += `–¢–ï–õ: ${conInput.value} (${formatMod(getMod(conInput.value))})\n`;
             txt += `–ò–ù–¢: ${intInput.value} (${formatMod(getMod(intInput.value))})\n`;
             txt += `–ú–î–†: ${wisInput.value} (${formatMod(getMod(wisInput.value))})\n`;
             txt += `–•–ê–†: ${chaInput.value} (${formatMod(getMod(chaInput.value))})\n`;

             const blob = new Blob([txt], { type: 'text/plain' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = `${(nameInput.value || '–ø–µ—Ä—Å–æ–Ω–∞–∂').replace(/\s+/g, '_')}.txt`;
             document.body.appendChild(a);
             a.click();
             document.body.removeChild(a);
             URL.revokeObjectURL(url);
        });

        // --- Form Listeners ---
        nameInput.addEventListener('input', updateSummaryInfo);
        bgInput.addEventListener('input', updateSummaryInfo);
        alignSelect.addEventListener('change', updateSummaryInfo);
        expInput.addEventListener('input', () => { /* –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤ —Å–≤–æ–¥–∫–µ */ });
        
        raceSelect.addEventListener('change', updateRaceInfo);
        classSelect.addEventListener('change', updateClassInfo);
        levelInput.addEventListener('input', updateLevelInfo);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º 'change' –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π –≤–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞
        strInput.addEventListener('change', updateStatInputs);
        dexInput.addEventListener('change', updateStatInputs);
        conInput.addEventListener('change', updateStatInputs);
        intInput.addEventListener('change', updateStatInputs);
        wisInput.addEventListener('change', updateStatInputs);
        chaInput.addEventListener('change', updateStatInputs);

        // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ input, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
        const statInputs = [strInput, dexInput, conInput, intInput, wisInput, chaInput];
        statInputs.forEach(input => {
             let timeoutId;
             input.addEventListener('input', () => {
                 clearTimeout(timeoutId);
                 timeoutId = setTimeout(() => {
                     // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                     let val = parseInt(input.value) || 10;
                     val = Math.max(3, Math.min(20, val));
                     input.value = val;
                     // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥ —Ä—è–¥–æ–º –∏ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                     updateStatInputs();
                 }, 500); // –û–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞
             });
        });


        currentHpInput.addEventListener('input', updateSummaryInfo);
        maxHpInput.addEventListener('input', updateSummaryInfo);
        baseSpeedInput.addEventListener('input', () => {
             let val = parseInt(baseSpeedInput.value) || 0;
             val = Math.max(0, Math.min(200, val)); // –û–≥—Ä–∞–Ω–∏—á–∏–º —Å–≤–µ—Ä—Ö—É
             baseSpeedInput.value = val;
             updateCombatInfo();
        });

        // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ –Ω–∞–≤—ã–∫–æ–≤
        for (let skill in skillCheckboxes) {
             skillCheckboxes[skill].addEventListener('change', updateSavesAndSkills);
        }

        // --- Avatar Upload ---
        avatarUpload.addEventListener('change', (event) => {
             const file = event.target.files[0];
             if (file) {
                 const reader = new FileReader();
                 reader.onload = (e) => {
                     currentAvatar = e.target.result;
                     summaryAvatar.src = currentAvatar;
                     // –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ currentAvatar –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
                 };
                 reader.readAsDataURL(file);
             }
        });


        // --- Initial Setup ---
        populateCharSelector();
        updateRaceInfo(); // –≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        updateClassInfo();
        updateLevelInfo();
        updateStatInputs();

    });
  </script>
</body>
</html>
