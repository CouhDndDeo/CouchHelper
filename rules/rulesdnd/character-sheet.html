<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
  <link rel="stylesheet" href="../../style.css" />
  <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<style>
  body {
    font-family: 'Georgia', serif;
    background: #fff;
    color: #000;
    margin: 0;
    padding: 0;
    line-height: 1.6;
  }

  .container {
    max-width: 100%;
    margin: 0;
    padding: 10px;
  }

  header, nav, footer, .no-print {
    display: none;
  }

  .char-summary {
    border: 1px solid #000;
    padding: 15px;
    border-radius: 0;
    box-shadow: none;
  }

  .summary-details > div {
    border-right: 1px solid #000;
  }

  .summary-stats {
    page-break-inside: avoid;
  }

  .summary-stat {
    border: 1px solid #000;
  }

  .summary-combat {
    border: 1px solid #000;
    background: #eee;
  }

  .summary-quick-info h4 {
    border-bottom: 1px solid #000;
  }

  .summary-quick-info ul {
    columns: 2;
    column-gap: 20px;
  }

  @media print {
    body {
      font-size: 0.85em;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 100%;
      margin: 0;
      padding: 10px;
      border: none;
      box-shadow: none;
    }

    header, nav, footer, .no-print {
      display: none;
    }

    .main-layout {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .form-section {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #000;
      box-shadow: none;
    }

    .stats-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
    }

    .stat-box {
      padding: 5px;
    }

    .skills-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 5px;
    }

    .skills-grid li {
      font-size: 0.9em;
    }

    .form-buttons {
      display: none;
    }

    .summary-section {
      page-break-inside: avoid;
      border: 1px solid #000;
      padding: 10px;
      box-shadow: none;
    }

    .summary-stats {
      grid-template-columns: repeat(6, 1fr);
      gap: 5px;
    }

    .summary-stat {
      padding: 5px;
    }

    .summary-combat {
      flex-wrap: wrap;
    }

    .summary-combat > div {
      flex: 1 1 45%;
      margin-bottom: 5px;
    }

    .summary-quick-info ul {
      columns: 1;
    }

    @page {
      size: A4;
      margin: 0.5cm;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üßæ –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h1>
      <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º D&D 5e</p>
    </header>

    <nav>
      <a href="../rules-dnd.html" class="btn-back">
        <span class="arrow">‚Üê</span>
        <span class="text">–í –º–µ–Ω—é D&D</span>
      </a>
    </nav>

    <main class="main-layout">
      <!-- üìù –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
      <section class="form-section">
        <h3>üìù –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <div class="form-row">
          <label>
            –ò–º—è:
            <input type="text" id="char-name" placeholder="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" />
          </label>
          <label>
            –ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è:
            <input type="text" id="char-background" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ—Å—Ç–æ–ª—é–¥–∏–Ω" />
          </label>
        </div>
        <div class="form-row">
          <label>
            –ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:
            <select id="char-alignment">
              <option value="–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–¥–æ–±—Ä—ã–π</option>
              <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–¥–æ–±—Ä—ã–π</option>
              <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–¥–æ–±—Ä—ã–π</option>
              <option value="–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ó–∞–∫–æ–Ω–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
              <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
              <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">–•–∞–æ—Ç–∏—á–Ω–æ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
              <option value="–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π">–ó–∞–∫–æ–Ω–Ω–æ-–∑–ª–æ–π</option>
              <option value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ-–∑–ª–æ–π</option>
              <option value="–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π">–•–∞–æ—Ç–∏—á–Ω–æ-–∑–ª–æ–π</option>
            </select>
          </label>
          <label>
            –û–ø—ã—Ç:
            <input type="number" id="char-exp" value="0" />
          </label>
        </div>
        <div class="form-row">
          <label>
            –ê–≤–∞—Ç–∞—Ä:
            <input type="file" id="avatar-upload" accept="image/*">
          </label>
        </div>
      </section>

      <!-- üß¨ –†–∞—Å–∞ –∏ –ö–ª–∞—Å—Å -->
      <section class="form-section">
        <h3>üß¨ –†–∞—Å–∞ –∏ –ö–ª–∞—Å—Å</h3>
        <div class="form-row">
          <label>
            –†–∞—Å–∞:
            <select id="char-race">
              <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
              <option value="elf">–≠–ª—å—Ñ</option>
              <option value="dwarf">–î–≤–∞—Ä—Ñ</option>
              <option value="halfling">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫</option>
              <option value="gnome">–ì–Ω–æ–º</option>
              <option value="half-elf">–ü–æ–ª—É—ç–ª—å—Ñ</option>
              <option value="half-orc">–ü–æ–ª—É–æ—Ä–∫</option>
              <option value="tiefling">–¢–∏—Ñ–ª–∏–Ω–≥</option>
              <option value="aarakocra">–ê–∞—Ä–∞–∫–æ–∫—Ä–∞</option>
              <option value="aasimar">–ê–∞—Å–∏–º–∞—Ä</option>
              <option value="bugbear">–ë–∞–≥–±–∏—Ä</option>
              <option value="gith">–ì–∏—Ç</option>
              <option value="giff">–ì–∏—Ñ—Ñ</option>
              <option value="simic-hybrid">–ì–∏–±—Ä–∏–¥ –°–∏–º–∏–∫–æ–≤</option>
              <option value="verdan">–í–µ—Ä–¥–∞–Ω</option>
              <option value="vedalken">–í–µ–¥–∞–ª–∫–µ–Ω</option>
              <option value="autognome">–ê–≤—Ç–æ–≥–Ω–æ–º</option>
              <!-- –î–æ–±–∞–≤—å –±–æ–ª—å—à–µ —Ä–∞—Å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ -->
            </select>
          </label>
          <label>
            –ö–ª–∞—Å—Å:
            <select id="char-class">
              <option value="–≤–æ–∏–Ω">–í–æ–∏–Ω</option>
              <option value="–º–∞–≥">–ú–∞–≥</option>
              <option value="–∂—Ä–µ—Ü">–ñ—Ä–µ—Ü</option>
              <option value="—Ä–∞–∑–±–æ–π–Ω–∏–∫">–†–∞–∑–±–æ–π–Ω–∏–∫</option>
              <option value="–ø–∞–ª–∞–¥–∏–Ω">–ü–∞–ª–∞–¥–∏–Ω</option>
              <option value="—Å–ª–µ–¥–æ–ø—ã—Ç">–°–ª–µ–¥–æ–ø—ã—Ç</option>
              <option value="–≤–∞—Ä–≤–∞—Ä">–í–∞—Ä–≤–∞—Ä</option>
              <option value="–¥—Ä—É–∏–¥">–î—Ä—É–∏–¥</option>
              <option value="–±–∞—Ä–¥">–ë–∞—Ä–¥</option>
              <option value="—á–∞—Ä–æ–¥–µ–π">–ß–∞—Ä–æ–¥–µ–π</option>
              <option value="–∫–æ–ª–¥—É–Ω">–ö–æ–ª–¥—É–Ω</option>
              <option value="–º–æ–Ω–∞—Ö">–ú–æ–Ω–∞—Ö</option>
            </select>
          </label>
          <label>
            –£—Ä–æ–≤–µ–Ω—å:
            <input type="number" id="char-level" min="1" max="20" value="1" />
          </label>
        </div>
      </section>

      <!-- üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
      <div class="form-section">
  <h3>üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
  <div class="stats-grid">
    <div class="stat-box">
      <label for="str">–°–ò–õ</label>
      <input type="number" id="str" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="str-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="str-bonus">+0</span></div>
    </div>
    <div class="stat-box">
      <label for="dex">–õ–û–í</label>
      <input type="number" id="dex" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="dex-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="dex-bonus">+0</span></div>
    </div>
    <div class="stat-box">
      <label for="con">–¢–ï–õ</label>
      <input type="number" id="con" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="con-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="con-bonus">+0</span></div>
    </div>
    <div class="stat-box">
      <label for="int">–ò–ù–¢</label>
      <input type="number" id="int" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="int-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="int-bonus">+0</span></div>
    </div>
    <div class="stat-box">
      <label for="wis">–ú–î–†</label>
      <input type="number" id="wis" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="wis-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="wis-bonus">+0</span></div>
      <div class="passive-perception">–ü–∞—Å—Å–∏–≤–Ω–æ–µ –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ: <span id="passive-perception">10</span></div>
    </div>
    <div class="stat-box">
      <label for="cha">–•–ê–†</label>
      <input type="number" id="cha" min="3" max="20" value="10" />
      <div class="stat-mod">–º–æ–¥ (<span id="cha-mod">+0</span>)</div>
      <div class="stat-bonus" title="–ë–æ–Ω—É—Å –æ—Ç —Ä–∞—Å—ã –∏–ª–∏ –∫–ª–∞—Å—Å–∞"><span id="cha-bonus">+0</span></div>
    </div>
  </div>
</div>

      <!-- üõ°Ô∏è –ë–æ–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
      <section class="form-section">
        <h3>üõ°Ô∏è –ë–æ–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
        <div class="form-row">
          <label>
            –ö–æ—Å—Ç—å –•–∏—Ç–æ–≤ (HD):
            <input type="text" id="hit-die" placeholder="1–∫10" readonly />
          </label>
          <label>
            –¢–µ–∫—É—â–∏–µ –•–ü:
            <input type="number" id="current-hp" placeholder="–¢–µ–∫—É—â–∏–µ" />
          </label>
          <label>
            –ú–∞–∫—Å. –•–ü:
            <input type="number" id="max-hp" placeholder="–ú–∞–∫—Å–∏–º—É–º" />
          </label>
        </div>
        <div class="form-row">
          <label>
            –ö–î (–±–µ–∑ –¥–æ—Å–ø–∞—Ö–∞):
            <span id="calculated-ac">10</span>
          </label>
          <label>
            –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ñ—É—Ç—ã):
            <input type="number" id="base-speed" value="30" />
          </label>
          <label>
            –°–∫–æ—Ä–æ—Å—Ç—å (—Ñ—É—Ç—ã):
            <span id="calculated-speed">30</span>
          </label>
        </div>
        <div class="form-row">
          <label>
            –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:
            <span id="calculated-init">+0</span>
          </label>
        </div>
        <div class="form-row">
          <label>
            –ë–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞:
            <span id="proficiency-bonus">+2</span>
          </label>
</div>
      </section>

      <!-- üéØ –ù–∞–≤—ã–∫–∏ -->
      <section class="form-section">
        <h3>üéØ –ù–∞–≤—ã–∫–∏</h3>
        <div class="skill-ownership-notice" style="margin-bottom: 15px; font-style: italic; color: #d4af37;">
          –í—ã –≤–ª–∞–¥–µ–µ—Ç–µ –Ω–∞–≤—ã–∫–∞–º–∏: <strong>‚Äî</strong>. –ü—Ä–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫–∏ –Ω–∏–∂–µ.
        </div>
        <ul class="skills-grid">
          <li><label><input type="checkbox" id="skill-acrobatics"> –ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞ (DEX)</label></li>
          <li><label><input type="checkbox" id="skill-animal-handling"> –£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏ (WIS)</label></li>
          <li><label><input type="checkbox" id="skill-arcana"> –ú–∞–≥–∏—è (INT)</label></li>
          <li><label><input type="checkbox" id="skill-athletics"> –ê—Ç–ª–µ—Ç–∏–∫–∞ (STR)</label></li>
          <li><label><input type="checkbox" id="skill-deception"> –û–±–º–∞–Ω (CHA)</label></li>
          <li><label><input type="checkbox" id="skill-history"> –ò—Å—Ç–æ—Ä–∏—è (INT)</label></li>
          <li><label><input type="checkbox" id="skill-insight"> –ü—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (WIS)</label></li>
          <li><label><input type="checkbox" id="skill-intimidation"> –ó–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ (CHA)</label></li>
          <li><label><input type="checkbox" id="skill-investigation"> –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (INT)</label></li>
          <li><label><input type="checkbox" id="skill-medicine"> –ú–µ–¥–∏—Ü–∏–Ω–∞ (WIS)</label></li>
          <li><label><input type="checkbox" id="skill-nature"> –ü—Ä–∏—Ä–æ–¥–∞ (INT)</label></li>
          <li><label><input type="checkbox" id="skill-perception"> –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ (WIS)</label></li>
          <li><label><input type="checkbox" id="skill-performance"> –í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ (CHA)</label></li>
          <li><label><input type="checkbox" id="skill-persuasion"> –£–±–µ–∂–¥–µ–Ω–∏–µ (CHA)</label></li>
          <li><label><input type="checkbox" id="skill-religion"> –†–µ–ª–∏–≥–∏—è (INT)</label></li>
          <li><label><input type="checkbox" id="skill-sleight-of-hand"> –õ–æ–≤–∫–æ—Å—Ç—å —Ä—É–∫ (DEX)</label></li>
          <li><label><input type="checkbox" id="skill-stealth"> –°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å (DEX)</label></li>
          <li><label><input type="checkbox" id="skill-survival"> –í—ã–∂–∏–≤–∞–Ω–∏–µ (WIS)</label></li>
        </ul>
      </section>

      <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
      <div class="form-buttons">
        <button id="save-char" class="btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="export-char" class="btn-secondary">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="reset-char" class="btn-clear">üóëÔ∏è –°–±—Ä–æ—Å</button>
        <button id="print-char" class="btn-secondary" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
      </div>

      <!-- üé≠ –°–≤–æ–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
      <section class="summary-section">
        <h2>üé≠ –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</h2>
        <div class="avatar-container">
          <img id="summary-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' fill='%233a2a1a'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='60' fill='%23d4af37'%3E%F0%9F%91%A4%3C/text%3E%3C/svg%3E" alt="–ê–≤–∞—Ç–∞—Ä">
        </div>
        <div class="summary-name" id="summary-name">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
        <div class="summary-details">
          <div><strong>–†–∞—Å–∞:</strong> <span id="summary-race">—á–µ–ª–æ–≤–µ–∫</span></div>
          <div><strong>–ö–ª–∞—Å—Å:</strong> <span id="summary-class">–≤–æ–∏–Ω</span></div>
          <div><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="summary-level">1</span></div>
          <div><strong>–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è:</strong> <span id="summary-bg">-</span></div>
          <div><strong>–ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ:</strong> <span id="summary-align">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</span></div>
        </div>

        <div class="summary-stats">
          <div class="summary-stat">
            <div class="summary-stat-name">–°–ò–õ</div>
            <div class="summary-stat-value" id="summary-str-val">10</div>
            <div class="summary-stat-mod" id="summary-str-mod">+0</div>
          </div>
          <div class="summary-stat">
            <div class="summary-stat-name">–õ–û–í</div>
            <div class="summary-stat-value" id="summary-dex-val">10</div>
            <div class="summary-stat-mod" id="summary-dex-mod">+0</div>
          </div>
          <div class="summary-stat">
            <div class="summary-stat-name">–¢–ï–õ</div>
            <div class="summary-stat-value" id="summary-con-val">10</div>
            <div class="summary-stat-mod" id="summary-con-mod">+0</div>
          </div>
          <div class="summary-stat">
            <div class="summary-stat-name">–ò–ù–¢</div>
            <div class="summary-stat-value" id="summary-int-val">10</div>
            <div class="summary-stat-mod" id="summary-int-mod">+0</div>
          </div>
          <div class="summary-stat">
            <div class="summary-stat-name">–ú–î–†</div>
            <div class="summary-stat-value" id="summary-wis-val">10</div>
            <div class="summary-stat-mod" id="summary-wis-mod">+0</div>
            <div class="passive-perception">–ü–∞—Å—Å–∏–≤–Ω–æ–µ –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ: <span id="summary-pass-wis">10</span></div>
          </div>
          <div class="summary-stat">
            <div class="summary-stat-name">–•–ê–†</div>
            <div class="summary-stat-value" id="summary-cha-val">10</div>
            <div class="summary-stat-mod" id="summary-cha-mod">+0</div>
          </div>
        </div>
        <div class="summary-combat">
          <div><strong>–ö–î:</strong> <span id="summary-ac">10</span></div>
          <div><strong>–•–ü:</strong> <span id="summary-hp">0</span>/<span id="summary-max-hp">0</span></div>
          <div><strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> <span id="summary-speed">30</span> —Ñ—É—Ç–æ–≤</div>
          <div><strong>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞:</strong> <span id="summary-init">+0</span></div>
          <div><strong>–ë–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞:</strong> <span id="summary-prof-bonus">+2</span></div>
        </div>

        <div class="summary-quick-info">
          <div style="display: flex; gap: 40px; flex-wrap: wrap;">
            <div>
              <h4>–°–ø–∞—Å–±—Ä–æ—Å–∫–∏</h4>
              <ul id="summary-saves">
                <li>–°–∏–ª: +0</li>
                <li>–õ–æ–≤: +0</li>
                <li>–¢–µ–ª: +0</li>
                <li>–ò–Ω—Ç: +0</li>
                <li>–ú–¥—Ä: +0</li>
                <li>–•–∞—Ä: +0</li>
              </ul>
            </div>
            <div>
              <h4>–ù–∞–≤—ã–∫–∏</h4>
              <ul id="summary-skills">
                <li>–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ: +0</li>
                <li>–ê—Ç–ª–µ—Ç–∏–∫–∞: +0</li>
                <li>... (–≤—ã–±–µ—Ä–∏—Ç–µ –≤ —Ñ–æ—Ä–º–µ)</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // --- –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã ---
    const nameInput = document.getElementById("char-name");
    const raceSelect = document.getElementById("char-race");
    const classSelect = document.getElementById("char-class");
    const levelInput = document.getElementById("char-level");
    const bgInput = document.getElementById("char-background");
    const alignSelect = document.getElementById("char-alignment");
    const expInput = document.getElementById("char-exp");
    const avatarUpload = document.getElementById("avatar-upload");

    const statsInputs = {
      str: document.getElementById("str"),
      dex: document.getElementById("dex"),
      con: document.getElementById("con"),
      int: document.getElementById("int"),
      wis: document.getElementById("wis"),
      cha: document.getElementById("cha")
    };

    const hitDieInput = document.getElementById("hit-die");
    const currentHpInput = document.getElementById("current-hp");
    const maxHpInput = document.getElementById("max-hp");
    const baseSpeedInput = document.getElementById("base-speed");

    const skillCheckboxes = {};
    document.querySelectorAll('.skills-grid input[type="checkbox"]').forEach(cb => {
      skillCheckboxes[cb.id.replace('skill-', '')] = cb;
    });

    const saveBtn = document.getElementById("save-char");
    const exportBtn = document.getElementById("export-char");
    const resetBtn = document.getElementById("reset-char");
    const printBtn = document.getElementById("print-char");

    // --- –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ---
    const summaryAvatar = document.getElementById("summary-avatar");
    const preview = {
      name: document.getElementById("summary-name"),
      race: document.getElementById("summary-race"),
      class: document.getElementById("summary-class"),
      level: document.getElementById("summary-level"),
      bg: document.getElementById("summary-bg"),
      align: document.getElementById("summary-align"),
      // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
      strVal: document.getElementById("summary-str-val"),
      dexVal: document.getElementById("summary-dex-val"),
      conVal: document.getElementById("summary-con-val"),
      intVal: document.getElementById("summary-int-val"),
      wisVal: document.getElementById("summary-wis-val"),
      chaVal: document.getElementById("summary-cha-val"),
      strMod: document.getElementById("summary-str-mod"),
      dexMod: document.getElementById("summary-dex-mod"),
      conMod: document.getElementById("summary-con-mod"),
      intMod: document.getElementById("summary-int-mod"),
      wisMod: document.getElementById("summary-wis-mod"),
      chaMod: document.getElementById("summary-cha-mod"),
      passWis: document.getElementById("summary-pass-wis"),
      // –ë–æ–µ–≤—ã–µ
      ac: document.getElementById("summary-ac"),
      speed: document.getElementById("summary-speed"),
      init: document.getElementById("summary-init"),
      hp: document.getElementById("summary-hp"),
      maxHp: document.getElementById("summary-max-hp"),
      // –°–ø–∞—Å–±—Ä–æ—Å–∫–∏ –∏ –Ω–∞–≤—ã–∫–∏
      savesList: document.getElementById("summary-saves"),
      skillsList: document.getElementById("summary-skills")
    };

    // --- –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è ---
    const calculatedAc = document.getElementById("calculated-ac");
    const calculatedSpeed = document.getElementById("calculated-speed");
    const calculatedInit = document.getElementById("calculated-init");
    const passivePerception = document.getElementById("passive-perception");

    // --- –ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ —Ä–∞—Å—ã ---
    const raceBonusInfoDiv = document.getElementById("race-bonus-info");
    const raceBonusesList = document.getElementById("race-bonuses-list");

    // --- State ---
    let raceClassData = {};
    let characters = JSON.parse(localStorage.getItem("dnd-characters")) || {};
    let currentCharId = null;

    // --- –§—É–Ω–∫—Ü–∏–∏ ---

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á—ë—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
    function getMod(value) {
      return Math.floor((value - 10) / 2);
    }

    function formatMod(mod) {
      return mod >= 0 ? `+${mod}` : `${mod}`;
    }

    // --- –õ–æ–≥–∏–∫–∞ —Ä–∞—Å ---
    function updateRaceBonuses() {
      const raceKey = raceSelect.value;
      const race = raceClassData.races && raceClassData.races[raceKey];

      // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–æ–Ω—É—Å–æ–≤
      raceBonusesList.innerHTML = "";

      if (race && race.bonuses) {
        raceBonusInfoDiv.style.display = "block";
        let bonusesText = [];

        // –ë–æ–Ω—É—Å—ã –∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º
        for (const [stat, bonus] of Object.entries(race.bonuses)) {
          if (["str", "dex", "con", "int", "wis", "cha"].includes(stat)) {
            bonusesText.push(`+${bonus} –∫ ${stat.toUpperCase()}`);
          }
        }
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã
        if (race.bonuses["choose-2-stats"] === 1) {
          bonusesText.push("+1 –∫ –¥–≤—É–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –Ω–∞ –≤—ã–±–æ—Ä");
        }
        if (race.bonuses["choose-1-stat"] === 1) {
          bonusesText.push("+1 –∫ –æ–¥–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–µ –Ω–∞ –≤—ã–±–æ—Ä");
        }
        if (race.bonuses["additional-language"] === 1) {
          bonusesText.push("+1 —è–∑—ã–∫ –Ω–∞ –≤—ã–±–æ—Ä");
        }
        if (race.fly) {
          bonusesText.push(`–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª—ë—Ç–∞ ${race.fly} —Ñ—É—Ç–æ–≤`);
        }
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (—Ä–∞–∑–º–µ—Ä, —è–∑—ã–∫–∏, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —Ç.–¥.)

        if (bonusesText.length > 0) {
          bonusesText.forEach(text => {
            const li = document.createElement("li");
            li.textContent = text;
            raceBonusesList.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent = "–ë–∞–∑–æ–≤—ã–µ –±–æ–Ω—É—Å—ã (–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ä–∞—Å—ã)";
          raceBonusesList.appendChild(li);
        }
      } else {
        raceBonusInfoDiv.style.display = "none";
      }
    }

    // --- –õ–æ–≥–∏–∫–∞ –∫–ª–∞—Å—Å–æ–≤ ---
    function updateClassInfo() {
      const classKey = classSelect.value;
      const cls = raceClassData.classes && raceClassData.classes[classKey];
      if (cls && cls.hitDie) {
        hitDieInput.value = cls.hitDie;
      } else {
        hitDieInput.value = "";
      }
    }

    // --- –õ–æ–≥–∏–∫–∞ —É—Ä–æ–≤–Ω—è ---
    function updateLevelInfo() {
      let level = parseInt(levelInput.value) || 1;
      level = Math.max(1, Math.min(20, level));
      levelInput.value = level;

      // –ë–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞
      const profBonus = Math.ceil(1 + level / 4);
      document.getElementById("proficiency-bonus").textContent = formatMod(profBonus);
      preview.profBonus.textContent = formatMod(profBonus);
    }

    // --- –õ–æ–≥–∏–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ---
    function updateStatInputs() {
      const stats = {};
      for (let key in statsInputs) {
        let val = parseInt(statsInputs[key].value) || 10;
        val = Math.max(3, Math.min(20, val));
        statsInputs[key].value = val;
        stats[key] = val;
      }

      // 1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
      const mods = {};
      for (let key in stats) {
        mods[key] = getMod(stats[key]);
      }

      // 2. –ö–î (–±–µ–∑ –¥–æ—Å–ø–∞—Ö–∞)
      const ac = 10 + mods.dex;
      calculatedAc.textContent = ac;
      preview.ac.textContent = ac;

      // 3. –°–∫–æ—Ä–æ—Å—Ç—å (–ø–æ–∫–∞ –±–∞–∑–æ–≤–∞—è, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
      const speed = parseInt(baseSpeedInput.value) || 30;
      calculatedSpeed.textContent = speed;
      preview.speed.textContent = speed;

      // 4. –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞
      const init = mods.dex;
      calculatedInit.textContent = formatMod(init);
      preview.init.textContent = formatMod(init);

      // 5. –ü–∞—Å—Å–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
      const passWis = 10 + mods.wis;
      passivePerception.textContent = passWis;
      preview.passWis.textContent = passWis;

      // 6. –°–ø–∞—Å–±—Ä–æ—Å–∫–∏ (–ø–æ–∫–∞ –±–µ–∑ –≤–ª–∞–¥–µ–Ω–∏—è)
      const savesHtml = `
        <li>–°–∏–ª–∞: ${formatMod(mods.str)}</li>
        <li>–õ–æ–≤–∫–æ—Å—Ç—å: ${formatMod(mods.dex)}</li>
        <li>–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ: ${formatMod(mods.con)}</li>
        <li>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: ${formatMod(mods.int)}</li>
        <li>–ú—É–¥—Ä–æ—Å—Ç—å: ${formatMod(mods.wis)}</li>
        <li>–•–∞—Ä–∏–∑–º–∞: ${formatMod(mods.cha)}</li>
      `;
      preview.savesList.innerHTML = savesHtml;

      // 7. –ù–∞–≤—ã–∫–∏ (–ø–æ–∫–∞ –±–µ–∑ –±–æ–Ω—É—Å–∞ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞)
      const proficiencyBonus = Math.ceil(1 + (parseInt(levelInput.value) || 1) / 4);
      const skillsData = [
        { id: 'acrobatics', stat: 'dex', name: '–ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞' },
        { id: 'animal-handling', stat: 'wis', name: '–£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏' },
        { id: 'arcana', stat: 'int', name: '–ú–∞–≥–∏—è' },
        { id: 'athletics', stat: 'str', name: '–ê—Ç–ª–µ—Ç–∏–∫–∞' },
        { id: 'deception', stat: 'cha', name: '–û–±–º–∞–Ω' },
        { id: 'history', stat: 'int', name: '–ò—Å—Ç–æ—Ä–∏—è' },
        { id: 'insight', stat: 'wis', name: '–ü—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å' },
        { id: 'intimidation', stat: 'cha', name: '–ó–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ' },
        { id: 'investigation', stat: 'int', name: '–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ' },
        { id: 'medicine', stat: 'wis', name: '–ú–µ–¥–∏—Ü–∏–Ω–∞' },
        { id: 'nature', stat: 'int', name: '–ü—Ä–∏—Ä–æ–¥–∞' },
        { id: 'perception', stat: 'wis', name: '–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ' },
        { id: 'performance', stat: 'cha', name: '–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ' },
        { id: 'persuasion', stat: 'cha', name: '–£–±–µ–∂–¥–µ–Ω–∏–µ' },
        { id: 'religion', stat: 'int', name: '–†–µ–ª–∏–≥–∏—è' },
        { id: 'sleight-of-hand', stat: 'dex', name: '–õ–æ–≤–∫–æ—Å—Ç—å —Ä—É–∫' },
        { id: 'stealth', stat: 'dex', name: '–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å' },
        { id: 'survival', stat: 'wis', name: '–í—ã–∂–∏–≤–∞–Ω–∏–µ' }
      ];

      let skillsHtml = '';
      skillsData.forEach(skill => {
        const isProficient = skillCheckboxes[skill.id] && skillCheckboxes[skill.id].checked;
        const skillMod = mods[skill.stat] + (isProficient ? proficiencyBonus : 0);
        skillsHtml += `<li>${skill.name}: ${formatMod(skillMod)}</li>`;
      });
      preview.skillsList.innerHTML = skillsHtml;

      // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ---
      preview.strVal.textContent = stats.str;
      preview.dexVal.textContent = stats.dex;
      preview.conVal.textContent = stats.con;
      preview.intVal.textContent = stats.int;
      preview.wisVal.textContent = stats.wis;
      preview.chaVal.textContent = stats.cha;

      preview.strMod.textContent = formatMod(mods.str);
      preview.dexMod.textContent = formatMod(mods.dex);
      preview.conMod.textContent = formatMod(mods.con);
      preview.intMod.textContent = formatMod(mods.int);
      preview.wisMod.textContent = formatMod(mods.wis);
      preview.chaMod.textContent = formatMod(mods.cha);
    }

    // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ---
    function updateCharacterInfo() {
      preview.name.textContent = nameInput.value || "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞";
      // preview.race.textContent = raceSelect.value; // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–ª—é—á, –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–≥–æ –∏–º–µ–Ω–∏
      // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –±—É–¥–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ option
      preview.race.textContent = raceSelect.options[raceSelect.selectedIndex].text;
      preview.class.textContent = classSelect.options[classSelect.selectedIndex].text;
      preview.level.textContent = levelInput.value;
      preview.bg.textContent = bgInput.value || "-";
      preview.align.textContent = alignSelect.value;
      preview.hp.textContent = currentHpInput.value || "0";
      preview.maxHp.textContent = maxHpInput.value || "0";
      preview.ac.textContent = calculatedAc.textContent;
      preview.speed.textContent = calculatedSpeed.textContent;
      preview.init.textContent = calculatedInit.textContent;
      preview.passWis.textContent = passivePerception.textContent;
    }

    // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ---
    function updateCalculations() {
      updateRaceBonuses();
      updateClassInfo();
      updateLevelInfo();
      updateStatInputs();
      updateCharacterInfo();
    }

    // --- –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π ---
    function populateCharSelector() {
      const selector = document.getElementById("char-selector");
      selector.innerHTML = '<option value="">-- –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ --</option>';
      for (let id in characters) {
        const option = document.createElement("option");
        option.value = id;
        option.textContent = characters[id].name || `–ü–µ—Ä—Å–æ–Ω–∞–∂ ${id.substring(0, 5)}`;
        selector.appendChild(option);
      }
    }

    function saveCharacter() {
      if (!currentCharId) {
        currentCharId = 'char_' + Date.now(); // –ü—Ä–æ—Å—Ç–æ–π ID
      }
      const data = {
        id: currentCharId,
        name: nameInput.value,
        race: raceSelect.value,
        class: classSelect.value,
        level: levelInput.value,
        background: bgInput.value,
        alignment: alignSelect.value,
        exp: expInput.value,
        stats: {},
        combat: {
          hitDie: hitDieInput.value,
          currentHp: currentHpInput.value,
          maxHp: maxHpInput.value,
          baseSpeed: baseSpeedInput.value
        },
        skills: {},
        avatar: summaryAvatar.src // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä
      };
      for (let key in statsInputs) {
        data.stats[key] = statsInputs[key].value;
      }
      for (let key in skillCheckboxes) {
        data.skills[key] = skillCheckboxes[key].checked;
      }
      characters[currentCharId] = data;
      localStorage.setItem("dnd-characters", JSON.stringify(characters));
      populateCharSelector();
      document.getElementById("char-selector").value = currentCharId; // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—É—â–∏–π
      alert("‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!");
    }

    function loadCharacter(id) {
      const char = characters[id];
      if (!char) return;
      currentCharId = id;
      nameInput.value = char.name || "";
      raceSelect.value = char.race || "human";
      classSelect.value = char.class || "–≤–æ–∏–Ω";
      levelInput.value = char.level || "1";
      bgInput.value = char.background || "";
      alignSelect.value = char.alignment || "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
      expInput.value = char.exp || "0";
      for (let key in char.stats) {
        if (statsInputs[key]) {
          statsInputs[key].value = char.stats[key];
        }
      }
      if (char.combat) {
        hitDieInput.value = char.combat.hitDie || "";
        currentHpInput.value = char.combat.currentHp || "";
        maxHpInput.value = char.combat.maxHp || "";
        baseSpeedInput.value = char.combat.baseSpeed || "30";
      }
      if (char.skills) {
        for (let key in char.skills) {
          if (skillCheckboxes[key] !== undefined) {
            skillCheckboxes[key].checked = char.skills[key];
          }
        }
      }
      if (char.avatar) {
        summaryAvatar.src = char.avatar;
      }
      updateCalculations();
    }

    function newCharacter() {
      currentCharId = null;
      nameInput.value = "";
      raceSelect.value = "human";
      classSelect.value = "–≤–æin";
      levelInput.value = "1";
      bgInput.value = "";
      alignSelect.value = "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
      expInput.value = "0";
      for (let key in statsInputs) {
        statsInputs[key].value = "10";
      }
      hitDieInput.value = "";
      currentHpInput.value = "";
      maxHpInput.value = "";
      baseSpeedInput.value = "30";
      for (let key in skillCheckboxes) {
        skillCheckboxes[key].checked = false;
      }
      summaryAvatar.src = "https://via.placeholder.com/100x100/3a2a1a/d4af37?text=üë§";
      updateCalculations();
      document.getElementById("char-selector").value = ""; // –í—ã–±–µ—Ä–µ—Ç "–ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂"
    }

    function deleteCharacter() {
      if (!currentCharId || !confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?")) return;
      delete characters[currentCharId];
      localStorage.setItem("dnd-characters", JSON.stringify(characters));
      newCharacter();
      populateCharSelector();
    }

    // --- –°–ª—É—à–∞—Ç–µ–ª–∏ ---
    nameInput.addEventListener("input", updateCharacterInfo);
    raceSelect.addEventListener("change", () => { updateCharacterInfo(); updateRaceBonuses(); updateCalculations(); });
    classSelect.addEventListener("change", () => { updateCharacterInfo(); updateClassInfo(); updateCalculations(); });
    levelInput.addEventListener("input", () => { updateCharacterInfo(); updateLevelInfo(); updateCalculations(); });
    bgInput.addEventListener("input", updateCharacterInfo);
    alignSelect.addEventListener("change", updateCharacterInfo);
    expInput.addEventListener("input", updateCharacterInfo);

    currentHpInput.addEventListener("input", updateCharacterInfo);
    maxHpInput.addEventListener("input", updateCharacterInfo);
    hitDieInput.addEventListener("input", updateCharacterInfo);
    baseSpeedInput.addEventListener("input", () => { updateCharacterInfo(); updateCalculations(); });

    for (let key in statsInputs) {
      statsInputs[key].addEventListener("input", () => { updateCharacterInfo(); updateCalculations(); });
    }

    for (let key in skillCheckboxes) {
      skillCheckboxes[key].addEventListener("change", updateCalculations);
    }

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ---
    saveBtn.addEventListener("click", saveCharacter);

    // --- –≠–∫—Å–ø–æ—Ä—Ç ---
    exportBtn.addEventListener("click", () => {
      // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç–∏–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      const data = {
        name: nameInput.value || "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
        race: raceSelect.options[raceSelect.selectedIndex].text,
        class: classSelect.options[classSelect.selectedIndex].text,
        level: levelInput.value,
        stats: {}
      };
      for (let key in statsInputs) {
        const value = parseInt(statsInputs[key].value);
        data.stats[key] = `${value} (${formatMod(getMod(value))})`;
      }

      let text = `=== –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===\n`;
      text += `–ò–º—è: ${data.name}\n`;
      text += `–†–∞—Å–∞: ${data.race}\n`;
      text += `–ö–ª–∞—Å—Å: ${data.class}\n`;
      text += `–£—Ä–æ–≤–µ–Ω—å: ${data.level}\n\n`;
      text += `–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n`;
      for (let key in data.stats) {
        const name = {
          str: "–°–∏–ª–∞", dex: "–õ–æ–≤–∫–æ—Å—Ç—å", con: "–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ",
          int: "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç", wis: "–ú—É–¥—Ä–æ—Å—Ç—å", cha: "–•–∞—Ä–∏–∑–º–∞"
        }[key];
        text += `- ${name}: ${data.stats[key]}\n`;
      }

      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `${data.name.replace(/\s+/g, '_') || "–ø–µ—Ä—Å–æ–Ω–∞–∂"}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // --- –°–±—Ä–æ—Å ---
    resetBtn.addEventListener("click", () => {
      if (confirm("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É?")) {
        newCharacter();
      }
    });

    // --- –ü–µ—á–∞—Ç—å ---
    printBtn.addEventListener("click", () => {
      window.open("print-character.html", "_blank");
    });

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ ---
    const saved = localStorage.getItem("dnd-character");
    if (saved) {
      try {
        const data = JSON.parse(saved);
        nameInput.value = data.name || "";
        raceSelect.value = data.race || "human";
        classSelect.value = data.class || "–≤–æ–∏–Ω";
        levelInput.value = data.level || "1";
        bgInput.value = data.background || "";
        alignSelect.value = data.alignment || "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";
        expInput.value = data.exp || "0";
        for (let key in data.stats) {
          if (statsInputs[key]) {
            statsInputs[key].value = data.stats[key];
          }
        }
        if (data.combat) {
          hitDieInput.value = data.combat.hitDie || "";
          currentHpInput.value = data.combat.currentHp || "";
          maxHpInput.value = data.combat.maxHp || "";
          baseSpeedInput.value = data.combat.baseSpeed || "30";
        }
        if (data.skills) {
          for (let key in data.skills) {
            if (skillCheckboxes[key] !== undefined) {
              skillCheckboxes[key].checked = data.skills[key];
            }
          }
        }
        if (data.avatar) {
          summaryAvatar.src = data.avatar;
        }
        updateCalculations();
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞", e);
      }
    }

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å –∏ –∫–ª–∞—Å—Å–æ–≤ ---
    fetch('../../data/races-classes.json')
      .then(r => {
        if (!r.ok) throw new Error(`–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ../../data/races-classes.json`);
        return r.json();
      })
      .then(data => {
        raceClassData = data;
        populateRaceSelect(data.races);
        populateClassSelect(data.classes);
        updateCalculations();
      })
      .catch(err => {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å –∏ –∫–ª–∞—Å—Å–æ–≤:", err);
        alert("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å –∏ –∫–ª–∞—Å—Å–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
      });

    function populateRaceSelect(races) {
      const select = document.getElementById("char-race");
      select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É --</option>';
      for (let key in races) {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = races[key].name;
        select.appendChild(opt);
      }
    }

    function populateClassSelect(classes) {
      const select = document.getElementById("char-class");
      select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å --</option>';
      for (let key in classes) {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = classes[key].name;
        select.appendChild(opt);
      }
    }

    // --- –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ---
    updateCalculations();
    populateCharSelector();

    // --- –°–ª—É—à–∞—Ç–µ–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π ---
    document.getElementById("char-selector").addEventListener("change", (e) => {
      const selectedId = e.target.value;
      if (selectedId) {
        loadCharacter(selectedId);
      } else {
        newCharacter();
      }
    });

    document.getElementById("new-char-btn").addEventListener("click", newCharacter);
    document.getElementById("delete-char-btn").addEventListener("click", deleteCharacter);
    document.getElementById("export-txt-btn").addEventListener("click", () => {
      // –ü—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç
      let txt = `=== –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===\n`;
      txt += `–ò–º—è: ${nameInput.value || "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞"}\n`;
      txt += `–†–∞—Å–∞: ${raceSelect.options[raceSelect.selectedIndex].text}\n`;
      txt += `–ö–ª–∞—Å—Å: ${classSelect.options[classSelect.selectedIndex].text}\n`;
      txt += `–£—Ä–æ–≤–µ–Ω—å: ${levelInput.value}\n`;
      txt += `–•–ü: ${currentHpInput.value || "0"}/${maxHpInput.value || "0"}\n`;
      txt += `–°–∫–æ—Ä–æ—Å—Ç—å: ${baseSpeedInput.value || "30"} —Ñ—É—Ç–æ–≤\n`;
      txt += `\n–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n`;
      for (let key in statsInputs) {
        const value = parseInt(statsInputs[key].value);
        txt += `- ${key.toUpperCase()}: ${value} (${formatMod(getMod(value))})\n`;
      }

      const blob = new Blob([txt], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `${(nameInput.value || "–ø–µ—Ä—Å–æ–Ω–∞–∂").replace(/\s+/g, '_')}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  });
</script>
    <footer>
      <p>–õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è D&D 5e</p>
    </footer>
  </div>


</body>
</html>
